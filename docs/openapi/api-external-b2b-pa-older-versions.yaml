openapi: 3.0.3
tags:
  - name: SenderReadB2B
    description: Non usata perché file secondario
  - name: NewNotification
    description: Non usata perché file secondario
paths:

  ###########################################################################################
  ###                          CREAZIONE RICHIESTE DI NOTIFICA                           ###
  ###########################################################################################

  "/delivery/requests":
    post:
      deprecated: true
      summary: Richiesta invio notifica
      description: |-
        Operazione utilizzata dalla Pubblica Amministrazione per richiedere l'invio di una notifica.

        La restituzione di uno stato HTTP 202 significa solo che la richiesta è sintatticamente
        valida, non che la richiesta sia stata validata ed accettata. <br/>
        Per conoscere lo stato di accettazione della richiesta di notifica bisogna utilizzare l'operazione
        _getNotificationRequestStatus_ oppure utilizzare la modalità push prevista dai webhook. <br/>
        
      tags:
        - NewNotification
      operationId: sendNewNotification
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v21-sendnewnotification-lambda:live'
      x-pagopa-lambda-account: core
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewNotificationRequest"
        required: true
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NewNotificationResponse"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '409':
          description: Conflict
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
    get:
      deprecated: true
      operationId: retrieveNotificationRequestStatus                 # ONLY EXTERNAL
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v21-getnotificationrequeststatus-lambda:live'
      x-pagopa-lambda-account: core
      tags:
        - SenderReadB2B
      summary: Verifica accettazione richiesta notifica
      description: >-
        Questa operazione serve per verificare se la richiesta di notifica è stata accettata e ottenere
        lo IUN associato a tale richiesta. <br/>
        Bisogna specificare il parametro _requestId_ oppure la coppia costituita dai parametri 
        _paProtocolNumber_ e _idempotenceToken_. <br/>
      parameters:
        - $ref: '#/components/parameters/notificationRequestId'
        - $ref: '#/components/parameters/paProtocolNumber'
        - $ref: '#/components/parameters/idempotenceToken'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NewNotificationRequestStatusResponse"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  "/delivery/v2.1/requests":
    post:
      summary: Richiesta invio notifica
      description: |-
        Operazione utilizzata dalla Pubblica Amministrazione per richiedere l'invio di una notifica.

        La restituzione di uno stato HTTP 202 significa solo che la richiesta è sintatticamente
        valida, non che la richiesta sia stata validata ed accettata. <br/>
        Per conoscere lo stato di accettazione della richiesta di notifica bisogna utilizzare l'operazione
        _getNotificationRequestStatus_ oppure utilizzare la modalità push prevista dai webhook. <br/>
        
      tags:
        - NewNotification
      operationId: sendNewNotificationV21
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v21-sendnewnotification-lambda:live'
      x-pagopa-lambda-account: core
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewNotificationRequestV21"
        required: true
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NewNotificationResponse"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '409':
          description: Conflict
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

    get:
      operationId: retrieveNotificationRequestStatusV21                 # ONLY EXTERNAL
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v21-getnotificationrequeststatus-lambda:live'
      x-pagopa-lambda-account: core
      tags:
        - SenderReadB2B
      summary: Verifica accettazione richiesta notifica
      description: >-
        Questa operazione serve per verificare se la richiesta di notifica è stata accettata e ottenere
        lo IUN associato a tale richiesta. <br/>
        Bisogna specificare il parametro _requestId_ oppure la coppia costituita dai parametri 
        _paProtocolNumber_ e _idempotenceToken_. <br/>
      parameters:
        - $ref: '#/components/parameters/notificationRequestId'
        - $ref: '#/components/parameters/paProtocolNumber'
        - $ref: '#/components/parameters/idempotenceToken'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NewNotificationRequestStatusResponseV21"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'



    ###########################################################################################
    ###                             RICERCA NOTIFICHE ACCETTATE                             ###
    ###########################################################################################

  "/delivery/notifications/sent/{iun}":
    get:
      deprecated: true
      summary: 'Mittente: lettura dettagli notifica'
      description: |-
        Questa operazione permette di leggere tutti i dettagli di una notifica accettata. <br/>

      tags:
        - SenderReadB2B
      operationId: retrieveSentNotification                                # ONLY EXTERNAL
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v2-getnotification-lambda:live'
      x-pagopa-lambda-account: core
      parameters:
        - $ref: './parameters-notification-search.yaml#/components/parameters/pathIun'
      responses:
        '200':
          description: OK
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/FullSentNotification"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  "/delivery/v2.0/notifications/sent/{iun}":
    get:
      deprecated: true
      summary: 'Mittente: lettura dettagli notifica versione 2'
      description: |-
        Questa operazione permette di leggere tutti i dettagli di una notifica accettata. <br/>
        
      tags:
        - SenderReadB2B
      operationId: retrieveSentNotificationV20                                # ONLY EXTERNAL
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v2-getnotification-lambda:live'
      x-pagopa-lambda-account: core
      parameters:
        - $ref: './parameters-notification-search.yaml#/components/parameters/pathIun'
      responses:
        '200':
          description: OK
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/FullSentNotificationV20"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'

  "/delivery/v2.1/notifications/sent/{iun}":
    get:
      summary: 'Mittente: lettura dettagli notifica versione 2'
      description: |-
        Questa operazione permette di leggere tutti i dettagli di una notifica accettata. <br/>

      tags:
        - SenderReadB2B
      operationId: retrieveSentNotificationV21                                # ONLY EXTERNAL
      x-pagopa-lambda-name: 'pn-delivery-versioning-v1v2-getnotification-lambda:live'
      x-pagopa-lambda-account: core
      parameters:
        - $ref: './parameters-notification-search.yaml#/components/parameters/pathIun'
      responses:
        '200':
          description: OK
          content:
            "application/json":
              schema:
                $ref: "#/components/schemas/FullSentNotificationV21"
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'


components:

  parameters:
    ############################################################################################
    ###                     PARAMETRO SORGENTE CREAZIONE NOTIFICA                            ###
    ############################################################################################


    ############################################################################################
    ###                     PARAMETRI DI AUTENTICAZIONE E AUTORIZZAZIONE                     ###
    ############################################################################################

    ############################################################################################
    ###                       PARAMETRI RICERCA RICHIESTA DI NOTIFICA                        ###
    ############################################################################################
    notificationRequestId:
      in: query
      required: false
      name: notificationRequestId
      description: identificativo della richiesta di notifica
      schema:
        type: string
        maxLength: 36
        pattern: ^[A-Za-z0-9+/=]{36}$
    paProtocolNumber:
      name: paProtocolNumber
      in: query
      required: false
      description: >-
        Numero di protocollo associato alla notifica, può essere riutilizzato per rettifiche.
      schema:
        type: string
        # wide range of characters
        pattern: ^.*$
        maxLength: 256
    idempotenceToken:
      name: idempotenceToken
      description: >-
        token usato per disambiguare "richieste di notificazione" effettuate con lo stesso 
        numero di protocollo.
      in: query
      required: false
      schema:
        type: string
        # ASCII printable characters
        pattern: ^[ -~]*$
        maxLength: 256


    ############################################################################################
    ###                             PARAMETRI DOWNLOAD DOCUMENTI                             ###
    ############################################################################################
    pathDocumentIdx:
      name: docIdx
      description: indice del documento nella lista partendo da 0.
      in: path
      required: true
      schema:
        type: integer
        format: int32
    pathRecipientIdx:
      name: recipientIdx
      description: indice del destinatario nella lista partendo da 0.
      in: path
      required: true
      schema:
        type: integer
        format: int32
    pathAttachmentName:
      name: attachmentName
      description: Tipologia del pagamento allegato alla notifica. Valori possibili PAGOPA|F24
      in: path
      required: true
      schema:
        type: string
        minLength: 3
        maxLength: 6
        pattern: "PAGOPA|F24"
    attachmentIdx:
      in: query
      name: attachmentIdx
      description: indice del documento di pagamento partendo da 0
      required: false
      schema:
        type: integer
        format: int32
    ############################################################################################
    ###                      PARAMETRI DOWNLOAD ATTI OPPONIBILI A TERZI                      ###
    ############################################################################################
    pathLegalFactType:
      $ref: './remote-refs.yaml#/components/parameters/pathLegalFactType'
    pathLegalFactId:
      $ref: './remote-refs.yaml#/components/parameters/pathLegalFactId'


  schemas:
    ###########################################################################################
    ###                             DTO STATUS PN                                           ###
    ###########################################################################################
    PnStatusResponse:
      $ref: './remote-refs.yaml#/components/schemas/PnStatusResponse'

    ###########################################################################################
    ###                             DTO NOTIFICATION PRICE                                  ###
    ###########################################################################################

    NotificationPriceResponse:
      title: Notification price Response
      description: >-
        Notification price and effective date
      type: object
      properties:
        iun:
          $ref: './schemas-pn-notification.yaml#/components/schemas/IUN'
        amount:
          description: amount in euro cents
          type: integer
          format: int32
        refinementDate:
          description: data di perfezionamento per decorrenza termini localizzata espressa alla mezzanotte del giorno in cui si verifica l'evento
          type: string
          format: date-time
        notificationViewDate:
          description: data di perfezionamento per presa visione espressa alla mezzanotte del giorno in cui si verifica l'evento
          type: string
          format: date-time

    ###########################################################################################
    ###                              DTO RICHIESTE DI NOTIFICA                              ###
    ###########################################################################################

    NewNotificationRequest:
      description: I campi utilizzati per la creazione di una nuova Notifica.
      type: object
      required:
        - paProtocolNumber
        - subject
        - recipients
        - documents
        - physicalCommunicationType
        - notificationFeePolicy
        - senderDenomination
        - senderTaxId
        - taxonomyCode
      properties:
        idempotenceToken:
          description: >-
            Identificativo utilizzabile dal chiamante per disambiguare differenti 
            "richieste di notificazione" effettuate con lo stesso numero di protocollo 
            (campo _paProtocolNumber_). Questo può essere necessario in caso di 
            "richiesta di notifica" rifiutata per errori nei codici di verifica degli
            allegati.
          type: string
          # ASCII printable characters
          pattern: ^[ -~]*$
          maxLength: 256
        paProtocolNumber:
          description: >-
            Numero di protocollo che la PA mittente assegna alla notifica stessa
          type: string
          # wide range of characters
          pattern: ^.*$
          maxLength: 256
        subject:
          type: string
          description: titolo della notifica, NON inserire dati personali/sensibili
          minLength: 10
          maxLength: 134
          # wide range of characters
          pattern: ^.*$
        abstract:
          type: string
          description: descrizione sintetica della notifica, NON inserire dati personali/sensibili
          # wide range of characters
          pattern: ^.*$
          maxLength: 1024
        recipients:
          type: array
          description: Informazioni sui destinatari
          items:
            $ref: "#/components/schemas/NotificationRecipient"
        documents:
          type: array
          description: Documenti notificati
          items:
            $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationDocument"
          minItems: 1
        notificationFeePolicy:
          $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationFeePolicy"
        cancelledIun:
          $ref: './schemas-pn-notification.yaml#/components/schemas/IUN'
        physicalCommunicationType:
          type: string
          description: Tipologia comunicazione fisica
          enum:
            - AR_REGISTERED_LETTER
            - REGISTERED_LETTER_890
        senderDenomination:
          $ref: './schemas-pn-notification.yaml#/components/schemas/Denomination'
        senderTaxId:
          $ref: './schemas-pn-notification.yaml#/components/schemas/paTaxId'
        group:
          type: string
          description: Gruppo di utenti dell'ente mittente che può visualizzare la notifica
          # ASCII printable characters
          pattern: ^[ -~]*$
          maxLength: 1024
        amount:
          type: integer
          format: int32
          description: Importo della notifica in eurocent
        paymentExpirationDate:
          type: string
          minLength: 10
          maxLength: 10
          pattern: "^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|[12][0-9]|0[1-9])$"
          description: Data di scadenza del pagamento nel formato YYYY-MM-DD riferito all'Italia
          # gestito come stringa e pattern perché con format: date open-api-generator non lo gestiva correttamente
        taxonomyCode:
          type: string
          minLength: 7
          maxLength: 7
          pattern: "^([0-9]{6}[A-Z]{1})$"
          description: >-
            Codice tassonomico della notifica basato sulla definizione presente nell'allegato 2 capitolo C del bando [__AVVISO PUBBLICO MISURA 1.4.5 PIATTAFORMA NOTIFICHE DIGITALI__](https://pnrrcomuni.fondazioneifel.it/bandi_public/Bando/325)      
        pagoPaIntMode:
          type: string
          description: >-
            Modalitá di integrazione pagoPA per l'attualizazione del costo della notifica. <br/>
            - _NONE_: nessuna attualizzazione. <br/>
            - _SYNC_: modalitá sincrona. <br/>
            - _ASYNC_: modalitá asincrona. (Non ancora supportata) <br/>
          enum:
            - NONE
            - SYNC
            - ASYNC
    SentNotification:
      description: >-
        Le informazioni riguardanti una richiesta di notifica accettata
      allOf:
        - $ref: '#/components/schemas/NewNotificationRequest'
        - type: object
          required:
            - iun
            - sentAt
          properties:
            senderPaId:
              type: string
              description: Identificativo (non IPA) della PA mittente che ha eseguito l'onboarding su SelfCare.
              # wide range of characters
              pattern: ^.*$
              maxLength: 256
            iun:
              $ref: '#/components/schemas/IUN'
            sentAt:
              type: string
              description: Momento di ricezione della notifica da parte di PN
              format: date-time
            cancelledByIun:
              $ref: './schemas-pn-notification.yaml#/components/schemas/IUN'
            documentsAvailable:
              type: boolean
              description: Indica se i documenti notificati sono ancora disponibili.

    NewNotificationRequestV21:
      description: I campi utilizzati per la creazione di una nuova Notifica.
      type: object
      required:
        - paProtocolNumber
        - subject
        - recipients
        - documents
        - physicalCommunicationType
        - notificationFeePolicy
        - senderDenomination
        - senderTaxId
        - taxonomyCode
      properties:
        idempotenceToken:
          description: >-
            Identificativo utilizzabile dal chiamante per disambiguare differenti 
            "richieste di notificazione" effettuate con lo stesso numero di protocollo 
            (campo _paProtocolNumber_). Questo può essere necessario in caso di 
            "richiesta di notifica" rifiutata per errori nei codici di verifica degli
            allegati.
          type: string
          # ASCII printable characters
          pattern: ^[ -~]*$
          maxLength: 256
        paProtocolNumber:
          description: >-
            Numero di protocollo che la PA mittente assegna alla notifica stessa
          type: string
          # wide range of characters
          pattern: ^.*$
          maxLength: 256
        subject:
          type: string
          description: titolo della notifica
          maxLength: 134
          # wide range of characters
          pattern: ^.*$
        abstract:
          type: string
          description: descrizione sintetica della notifica
          # wide range of characters
          pattern: ^.*$
          maxLength: 1024
        recipients:
          type: array
          description: Informazioni sui destinatari
          items:
            $ref: "#/components/schemas/NotificationRecipientV21"
        documents:
          type: array
          description: Documenti notificati
          items:
            $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationDocument"
          minItems: 1
        notificationFeePolicy:
          $ref: "#/components/schemas/NotificationFeePolicy"
        cancelledIun:
          $ref: '#/components/schemas/IUN'
        physicalCommunicationType:
          type: string
          description: Tipologia comunicazione fisica
          enum:
            - AR_REGISTERED_LETTER
            - REGISTERED_LETTER_890
        senderDenomination:
          $ref: '#/components/schemas/Denomination'
        senderTaxId:
          $ref: './schemas-pn-notification.yaml#/components/schemas/paTaxId'
        group:
          type: string
          description: Gruppo di utenti dell'ente mittente che può visualizzare la notifica
          # ASCII printable characters
          pattern: ^[ -~]*$
          maxLength: 1024
        amount:
          type: integer
          format: int32
          description: Importo della notifica in eurocent
        paymentExpirationDate:
          type: string
          minLength: 10
          maxLength: 10
          pattern: "^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|[12][0-9]|0[1-9])$"
          description: Data di scadenza del pagamento nel formato YYYY-MM-DD riferito all'Italia
          # gestito come stringa e pattern perché con format: date open-api-generator non lo gestiva correttamente
        taxonomyCode:
          type: string
          minLength: 7
          maxLength: 7
          pattern: "^([0-9]{6}[A-Z]{1})$"
          description: >-
            Codice tassonomico della notifica basato sulla definizione presente nell'allegato 2 capitolo C del bando [__AVVISO PUBBLICO MISURA 1.4.5 PIATTAFORMA NOTIFICHE DIGITALI__](https://pnrrcomuni.fondazioneifel.it/bandi_public/Bando/325)
        paFee:
          $ref: '#/components/schemas/PaFeeV21'
        vat:
          $ref: '#/components/schemas/VatV21'
        pagoPaIntMode:
          type: string
          description: >-
            Modalitá di integrazione pagoPA per l'attualizazione del costo della notifica. <br/>
            - _NONE_: nessuna attualizzazione. <br/>
            - _SYNC_: modalitá sincrona. <br/>
            - _ASYNC_: modalitá asincrona. (non ancora supportata)<br/>
          enum:
            - NONE
            - SYNC
            - ASYNC
    SentNotificationV21:
      description: >-
        Le informazioni riguardanti una richiesta di notifica accettata
      allOf:
        - $ref: '#/components/schemas/NewNotificationRequestV21'
        - type: object
          required:
            - iun
            - sentAt
          properties:
            senderPaId:
              type: string
              description: Identificativo (non IPA) della PA mittente che ha eseguito l'onboarding su SelfCare.
              # wide range of characters
              pattern: ^.*$
              maxLength: 256
            iun:
              $ref: '#/components/schemas/IUN'
            sentAt:
              type: string
              description: Momento di ricezione della notifica da parte di PN
              format: date-time
            cancelledByIun:
              $ref: '#/components/schemas/IUN'
            documentsAvailable:
              type: boolean
              description: Indica se i documenti notificati sono ancora disponibili.

    NewNotificationResponse:
      title: Identificativi della richiesta di notifica
      description: >-
        Contiene le informazioni per identificare una richiesta di invio notifica
        che non è ancora stata accettata da Piattaforma notifiche.
      type: object
      required:
        - notificationRequestId
        - paProtocolNumber
      properties:
        notificationRequestId:
          type: string
          description: >-
            identificativo univoco di una richiesta di invio notifica, non è lo IUN
          maxLength: 36
          pattern: ^[A-Za-z0-9+/=]{36}$
        paProtocolNumber:
          type: string
          description: Identificativo inviato dalla pubblica amministrazione
        idempotenceToken:
          description: >-
            Ripetizione del token usato per disambiguare "richieste di notificazione" 
            effettuate con lo stesso numero di protocollo (campo _paProtocolNumber_).
          type: string

    NewNotificationRequestStatusResponse:
      allOf:
        - $ref: "#/components/schemas/NewNotificationRequest"
        - type: object
          required:
            - notificationRequestId
            - notificationRequestStatus
          properties:
            notificationRequestId:
              description: >-
                identificativo univoco di una richiesta di invio notifica, non è lo IUN
              type: string
            notificationRequestStatus:
              description: >-
                - __WAITING__: in attesa di essere valutata
                - __ACCEPTED__: richiesta di notifica accettata, lo IUN è valorizzato
                - __REFUSED__: richiesta di notifica rifiutata, è valorizzato il campo _errors_
              type: string
            retryAfter:
              type: integer
              format: int32
              description: >-
                Numero di secondi da attendere prima di effettuare una nuova richiesta per 
                la stessa entità; valorizzato quando lo status è __WAITING__.
            iun:
              $ref: "./schemas-pn-notification.yaml#/components/schemas/IUN"
            errors:
              description: >-
                Elenco degli errori che hanno causato il rifiuto della richiesta di notifica
              type: array
              items:
                $ref: '#/components/schemas/ProblemError'

    NewNotificationRequestStatusResponseV21:
      allOf:
        - $ref: "#/components/schemas/NewNotificationRequestV21"
        - type: object
          required:
            - notificationRequestId
            - notificationRequestStatus
          properties:
            notificationRequestId:
              description: >-
                identificativo univoco di una richiesta di invio notifica, non è lo IUN
              type: string
            notificationRequestStatus:
              description: >-
                - __WAITING__: in attesa di essere valutata
                - __ACCEPTED__: richiesta di notifica accettata, lo IUN è valorizzato
                - __REFUSED__: richiesta di notifica rifiutata, è valorizzato il campo _errors_
              type: string
            retryAfter:
              type: integer
              format: int32
              description: >-
                Numero di secondi da attendere prima di effettuare una nuova richiesta per 
                la stessa entità; valorizzato quando lo status è __WAITING__.
            iun:
              $ref: "./schemas-pn-notification.yaml#/components/schemas/IUN"
            errors:
              description: >-
                Elenco degli errori che hanno causato il rifiuto della richiesta di notifica
              type: array
              items:
                $ref: '#/components/schemas/ProblemError'

    Problem:
      $ref: './remote-refs.yaml#/components/schemas/Problem'
    ProblemError:
      $ref: './remote-refs.yaml#/components/schemas/ProblemError'


    ###########################################################################################
    ###                              DTO NOTIFICA CON DETTAGLI                              ###
    ###########################################################################################

    FullSentNotification:
      description: >-
        Le informazioni riguardanti una notifica (richiesta di notifica accettata) e il 
        processo di inoltro della notifica verso il cittadino.
      allOf:
        - $ref: '#/components/schemas/SentNotification'
        - type: object
          required:
            - notificationStatus
            - notificationStatusHistory
            - timeline
          properties:
            notificationStatus:
              $ref: '#/components/schemas/NotificationStatus'
            notificationStatusHistory:
              $ref: '#/components/schemas/NotificationStatusHistory'
            timeline:
              description: >-
                elenco dettagliato di tutto ciò che è accaduto durrante il processo di notifica
              type: array
              items:
                $ref: '#/components/schemas/TimelineElement'

    FullSentNotificationV20:
      description: >-
        Le informazioni riguardanti una notifica (richiesta di notifica accettata) e il 
        processo di inoltro della notifica verso il cittadino.
      allOf:
        - $ref: '#/components/schemas/SentNotification'
        - type: object
          required:
            - notificationStatus
            - notificationStatusHistory
            - timeline
          properties:
            notificationStatus:
              $ref: '#/components/schemas/NotificationStatus'
            notificationStatusHistory:
              $ref: '#/components/schemas/NotificationStatusHistory'
            timeline:
              description: >-
                elenco dettagliato di tutto ciò che è accaduto durrante il processo di notifica
              type: array
              items:
                $ref: '#/components/schemas/TimelineElementV20'

    FullSentNotificationV21:
      description: >-
        Le informazioni riguardanti una notifica (richiesta di notifica accettata) e il
        processo di inoltro della notifica verso il cittadino.
      allOf:
        - $ref: '#/components/schemas/SentNotificationV21'
        - type: object
          required:
            - notificationStatus
            - notificationStatusHistory
            - timeline
          properties:
            notificationStatus:
              $ref: '#/components/schemas/NotificationStatus'
            notificationStatusHistory:
              $ref: '#/components/schemas/NotificationStatusHistory'
            timeline:
              description: >-
                elenco dettagliato di tutto ciò che è accaduto durrante il processo di notifica
              type: array
              items:
                $ref: '#/components/schemas/TimelineElementV20'

    PaFeeV21:
      type: integer
      description: >-
        Costo espresso in eurocent che la PA imputa per la notifica. <br/>
        Obbligatoria per notifiche con notificationFeePolicy=DELIVERY_MODE e modalità di integrazione Async o modalità di pagamento F24.<br/>
        Il default nei casi di non obbligatorietà è 100 <br/>
        Esempio paFee ad 1€ -> 100 <br/>
      format: int32
      minimum: 0
      maximum: 100

    VatV21:
      type: integer
      description: >-
        IVA espressa in percentuale imposta al mittente sulla notifica analogica. <br/>
        Obbligatoria per notifiche con notificationFeePolicy=DELIVERY_MODE e modalità di integrazione Async o modalità di pagamento F24.<br/>
        Il default nei casi di non obbligatorietà è 22 <br/>
        Per rispettare retro-compatibilitá campo non restituito nelle API v2.1 <br/>
        Esempio vat al 22% -> 22 <br/>
      format: int32
      minimum: 0
      maximum: 100

    NotificationRecipient:
      description: Informazioni sui destinatari
      required:
        - denomination
        - recipientType
        - taxId
        - physicalAddress
      type: object
      properties:
        recipientType:
          type: string
          description: 'Tipologia di destinatario: Persona Fisica (PF) o Persona Giuridica
            (PG)'
          enum:
            - PF
            - PG
        taxId:
          $ref: './schemas-pn-notification.yaml#/components/schemas/TaxId'
        denomination:
          $ref: './schemas-pn-notification.yaml#/components/schemas/Denomination'
        digitalDomicile:
          $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationDigitalAddress"
        physicalAddress:
          $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationPhysicalAddress"
        payment:
          $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationPaymentInfo"

    NotificationRecipientV21:
      description: Informazioni sui destinatari
      required:
        - denomination
        - recipientType
        - taxId
        - physicalAddress
      type: object
      additionalProperties: false
      properties:
        recipientType:
          type: string
          description: 'Tipologia di destinatario: Persona Fisica (PF) o Persona Giuridica
            (PG)'
          enum:
            - PF
            - PG
        taxId:
          $ref: './schemas-pn-notification.yaml#/components/schemas/TaxId'
        denomination:
          $ref: '#/components/schemas/Denomination'
        digitalDomicile:
          $ref: "#/components/schemas/NotificationDigitalAddress"
        physicalAddress:
          $ref: "#/components/schemas/NotificationPhysicalAddress"
        payments:
          $ref: "./schemas-pn-notification.yaml#/components/schemas/NotificationPayments"

    ###########################################################################################
    ###                              DTO EVENTO DI PAGAMENTO                                ###
    ###########################################################################################

    PaymentEventsRequestPagoPa:
      title: Invio eventi di pagamento da PA a PN
      description: >-
        Richiesta contenente un array di eventi di pagamento di tipo PagoPA di cui una Pubblica Amministrazione
        deve avvisare Piattaforma Notifiche.
      type: object
      required:
        - events
      properties:
        events:
          description: Elenco degli eventi di pagamento
          type: array
          items:
            $ref: '#/components/schemas/PaymentEventPagoPa'

    PaymentEventsRequestF24:
      title: Invio eventi di pagamento da PA a PN
      description: >-
        Richiesta contenente un array di eventi di pagamento di tipo F24 di cui una Pubblica Amministrazione
        deve avvisare Piattaforma Notifiche.
      type: object
      required:
        - events
      properties:
        events:
          description: Elenco degli eventi di pagamento
          type: array
          items:
            $ref: '#/components/schemas/PaymentEventF24'

    #PaymentEvents:
    #  type: object
    #  oneOf:
    #    - $ref: '#/components/schemas/PaymentEventPagoPa'
    #    - $ref: '#/components/schemas/PaymentEventF24'

    PaymentEventPagoPa:
      title: Evento di pagamento PagoPa
      description: >-
        Comprende: <br/>
          - _noticeCode_: "codice avviso pagoPA" di pagamento del sistema pagoPA, usato per pagamento online.<br/>
          - _creditorTaxId_: codice fiscale dell'ente a cui fa riferimento il "codice avviso pagoPA". <br/>
          - data e ora del pagamento. <br/>
          - importo del pagamento in eurocent. <br/>
      type: object
      required:
        - noticeCode
        - creditorTaxId
        - paymentDate
        - amount
      properties:
        noticeCode:
          $ref: 'schemas-pn-notification.yaml#/components/schemas/noticeCode'
        creditorTaxId:
          $ref: 'schemas-pn-notification.yaml#/components/schemas/paTaxId'
        paymentDate:
          type: string
          pattern: ^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(\.[0-9]+)?(Z|([+\-][0-9]{2}):([0-9]{2}))$
          description: data e ora in formato ISO 8601
        amount:
          type: integer
          format: int32

    PaymentEventF24:
      title: Evento di pagamento F24
      description: >-
        Comprende: <br/>
          - lo _IUN_ della notifica pagata, <br/>
          - data e ora del pagamento, <br/>
          - il codice fiscale del destinatario pagatore, <br/>
          - la tipologia del destinatario pagatore (PF / PG), <br/>
          - importo del pagamento in eurocent. <br/>
      type: object
      required:
        - iun
        - paymentDate
        - recipientTaxId
        - recipientType
        - amount
      properties:
        iun:
          type: string
          minLength: 25
          maxLength: 25
          pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
        paymentDate:
          type: string
          format: date-time
        recipientTaxId:
          $ref: 'schemas-pn-notification.yaml#/components/schemas/TaxId'
        recipientType:
          type: string
          minLength: 2
          maxLength: 2
          pattern: "PF|PG"
        amount:
          type: integer
          format: int32

    TimelineElement:
      $ref: './remote-refs.yaml#/components/schemas/TimelineElement'
    TimelineElementV20:
      $ref: './remote-refs.yaml#/components/schemas/TimelineElementV20'
    NotificationStatus:
      $ref: './remote-refs.yaml#/components/schemas/NotificationStatus'
    NotificationStatusHistory:
      $ref: './remote-refs.yaml#/components/schemas/NotificationStatusHistory'
    LegalFactDownloadMetadataResponse:
      $ref: './remote-refs.yaml#/components/schemas/LegalFactDownloadMetadataResponse'

  securitySchemes:        # ONLY EXTERNAL
    ApiKeyAuth:           # ONLY EXTERNAL
      type: apiKey        # ONLY EXTERNAL
      in: header          # ONLY EXTERNAL
      name: x-api-key     # ONLY EXTERNAL

security:                 # ONLY EXTERNAL
  - ApiKeyAuth: [] # use the same name as under securitySchemes    # ONLY EXTERNAL



