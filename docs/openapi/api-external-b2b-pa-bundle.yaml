openapi: 3.0.3
info:
  termsOfService: https://notifichedigitali.pagopa.it/pubbliche-amministrazioni/index.html
  x-api-id: api-external-b2b-pa
  title: 'Piattaforma Notifiche: API B2B per le Pubbliche Amministrazioni'
  x-summary: 'Piattaforma Notifiche: API B2B per le Pubbliche Amministrazioni'
  version: 1.0.0
  description: |-

    ## Abstract
      API utilizzate dalle pubbliche amministrazioni per __inviare richieste di notifiche__ e 
      __ottenere informazioni in modalità pull__ sullo stato della 
      _"richiesta di notifica"_ (accettata o rifiutata) e, in caso di richiesta accettata, 
      sulle comunicazioni effettuate, o solo tentate, nei confronti dei destinatari della notifica.

    ## Operazioni utilizzate, in sequenza temporale
    <table>
    <tr>
    <td>

     <img src="https://raw.githubusercontent.com/pagopa/pn-delivery/e6f1db9eac9ace7fc2ad0fe6de241ab4525b6b6a/docs/openapi/images/invio-notifica.png" height="790" width="515" alt="Invio notifica" />

       </br>
       </br>
       </br>
      
      #### 3. Verifica accettazione richiesta di invio notifica

      Per questa verifica possono essere utilizzate due modalità:
      
      1. __richiesta puntale__: consigliato solo ai fini di test
      2. __lettura da stream configurato__: consigliato per ambienti di produzione
      
      La differenza tra le due modalità è nell'interazione e nell'efficienza.
      
      Con la modalità _"richiesta puntuale"_ è necessario l'invocazione per ogni notifica,
      mentre con la modalità _"stream"_ è possibile avere gli aggiornamenti
      di stato di più notifiche con una sola invocazione.
      
      #### 3.1 Richiesta puntuale di verifica accettazione

      Questa modalità è resa disponibile solo ai fini di test o di eventuali operazioni
      di allineamento poiché richiede l'invio di una richiesta per ogni notifica.
      Se il passo (2) avviene con successo si utilizza l'operazione 
      [getNotificationRequestStatus](#/SenderReadB2B/getNotificationRequestStatusV2)
      per ottenere informazioni riguardo allo stato della "richiesta di invio di notifica". </br>
      Nel campo _notificationRequestStatus_ sarà indicato:</br>
      >\- <strong>WAITING:</strong> se la validazione è ancora in corso.</br>
      \- <strong>ACCEPTED:</strong> se richiesta di notifica accettata, lo _IUN_ è valorizzato.</br>
      \- <strong>REFUSED:</strong> se richiesta di notifica rifiutata, è valorizzato il campo _errors_.</br>
      </br>
      </br>
      </br>

      #### 3.2 Richiesta avanzamento via "stream" di verifica di accettazione

      Questa modalità è consigliata. Per essere fruita è necessaria un'operazione preliminare 
      tramite la chiamata alla API [createEventStream](https://petstore.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fpagopa%2Fpn-delivery-push%2Fdevelop%2Fdocs%2Fopenapi%2Fapi-external-b2b-webhook.yaml#/Streams/createEventStream)
      per configurare uno "stream" che registri il cambio di stato della notifica con il seguente payload:</br></br>``
      {
        "title": "NotificationAccepted",
        "eventType": "STATUS",
        "filterValues": [
          "ACCEPTED"
        ]
      }
      ``</br></br>
      Successivamente si possono ottenere i dati richiamando la API [consumeEventStream](https://petstore.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fpagopa%2Fpn-delivery-push%2Fdevelop%2Fdocs%2Fopenapi%2Fapi-external-b2b-webhook.yaml#/Events/consumeEventStream)
      
      
      __NOTA__ saranno disponibili i dati di cambiamento di stato occorsi solo successivamente alla configurazione
      dello stream.
      
      </br>
      </br>
      </br>
      </br>
      
    </td>
    <td>

      ### Ciclo di vita della notifica lato mittente
      
      #### 1. Caricamento dei documenti della notifica
      
      Prima di invocare la richiesta di notifica è necessario caricare i documenti della notifica (documenti e bollettini/metadati di pagamento).
      
      #### 1.a. Richiesta presigned Url
      
      Invocare l'operazione [presignedUploadRequest](#/NewNotification/presignedUploadRequest) 
      con cui prenotare il caricamento. Possono essere effettuate un massimo di <span id="numberOfPresignedRequest">15</span> prenotazioni di caricamento
      per ogni richiesta.</br>
      In risposta si ottengono le seguenti informazioni:<br/>
      \- httpMethod <br/>
      \- secret <br/>
      \- url <br/>
      L'url restituito ha una validità di 1h.
      
      </br>

      #### 1.b Upload documenti della notifica
      
      Per ogni documento utilizzare un richiesta HTTP con metodo _httpMethod_ (POST o PUT) 
      all'url indicato dal campo _url_. <br/>
      In tale richiesta vanno aggiunti i seguenti header: <br/>
      \- _content-type_: valorizzato come il campo "contentType" della richiesta di cui al punto (1.a) <br/>
      \- _x-amz-meta-secret_: valorizzato con il valore del campo "secret" della risposta di cui al punto (1.a) <br/>
      \- _trailer_: valorizzato con ```x-amz-checksum-sha256``` <br/>
      \- _x-amz-checksum-sha256_: valorizzato con il checksum sha256, codificato in base 64, del contenuto binario del file che verrà caricato. (__N.B.__ questo è un trailer HTTP non un header).
        Vedi [HTTP Trailer](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Trailer) <br/>
        __NOTA:__ se l'operazione di upload è stata eseguita con successo, si otterrà come risposta _status 200 OK_. <br/>
        Nell'header di questa risposta, si otterrà il campo __x-amz-version-id__ che dovrà essere utilizzato durante <br/> 
        l'inserimento della notifica, nel campo ref.__versionToken__ in corrispondenza del documento ad esso associato.

     
      </br>
      </br>
      </br>
      
      #### 2. Richiesta di invio della notifica

      Per effettuare una richiesta di invio notifica, invocare l'operazione 
      [sendNewNotification](#/NewNotification/sendNewNotificationV2) utilizzando i riferimenti dei file 
      caricati ottenuti al punto (1.b).
      
      </br>
      </br>
      </br>

       <img src="https://raw.githubusercontent.com/pagopa/pn-delivery/e6f1db9eac9ace7fc2ad0fe6de241ab4525b6b6a/docs/openapi/images/verifica-accettazione-richiesta-invio.png" height="731" width="489" alt="Verifica accettazione richiesta" />
    </td>
      
    </tr>
    </table>


      ### 4. Monitorare l'avanzamento di una notifica

      Allo stesso modo del monitoraggio dell'accettazione della notifica da parte della Piattaforma sono 
      disponibili le due modalità.
      
      #### 4.1 Monitoraggio puntuale

      Se la "richiesta di invio di notifica" passa le validazioni viene trasformata in "notifica" e sarà 
      identificata dalla IUN restituito dall'operazione 
      [getNotificationRequestStatus](#/SenderReadB2B/getNotificationRequestStatusV2).</br> 
      A tal punto si potranno utilizzare l'operazione _GET /delivery/v2/notifications/sent/{iun}_ per 
      ottenere i dettagli della notifica, la _timeline_ che dettaglia il perfezionamento della
      notifica per il mittente e l'avanzamento delle comunicazioni nei confronti dei destinatari.
      
      #### 4.1 Monitoraggio tramite stream

      Questa modalità è consigliata in produzione. Per essere fruita è necessaria una operazione preliminare
      tramite la chiamata alla API [createEventStream](https://petstore.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fpagopa%2Fpn-delivery-push%2Fdevelop%2Fdocs%2Fopenapi%2Fapi-external-b2b-webhook.yaml#/Streams/createEventStream)
      per configurare uno "stream" che registri il cambio di stato della notifica con il seguente payload di esempio:</br></br>``
      {
        "title": "NotificationAccepted",
        "eventType": "STATUS"
      }
      ``</br></br>che permette di monitorare gli eventi di tipo "STATO". Successivamente si può ottenere il dettaglio della stream appena creata chiamando la 
      API [getEventStream](https://petstore.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fpagopa%2Fpn-delivery-push%2Fdevelop%2Fdocs%2Fopenapi%2Fapi-external-b2b-webhook.yaml#/Streams/getEventStream), mentre si possono ottenere i dati degli eventi richiamando la API [consumeEventStream](https://petstore.swagger.io/?url=https%3A%2F%2Fraw.githubusercontent.com%2Fpagopa%2Fpn-delivery-push%2Fdevelop%2Fdocs%2Fopenapi%2Fapi-external-b2b-webhook.yaml#/Events/consumeEventStream)


      __NOTA__ saranno disponibili i dati di cambiamento di stato occorsi solo successivamente alla configurazione
      dello stream.

      </br>

      ### 5. Download dei Legal Facts

      E' possibile scaricare le Attestazioni Opponibili a Terzi e gli altri documenti conservati da Piattaforma Notifiche attraverso il servizio di [dowload Legal Fact](#/SenderReadB2B/getSentNotificationDocument) passando all'interno del path lo <strong>Iun</strong>, il <strong>legalFactType</strong> ed il <strong>legalFactId</strong>; si otterrà nella response un link che permette di scaricare il documento richiesto.</br> Per ottenere il <strong>legalFactType</strong> ed il <strong>legalFactId</strong> bisogna chiamare il servizio di [lettura dettaglio notifica](#/SenderReadB2B/getSentNotification) con lo <code>{Iun}</code> della notifica di interesse: all'interno del campo <i>timeline</i> della response è possibile trovare l'elenco degli eventi di quella notifica ed i <strong>legalFactType</strong> e <strong>legalFactId</strong> in corrispondenza degli eventi che generano documenti.
      
    </br> <h3>Le FAQ possono essere consultate al seguente link: <a href="https://docs.pagopa.it/v1.0-1/">https://docs.pagopa.it/v1.0-1/</a></h3>
    <details>
      <summary><strong><big><big><big><big>AMBIENTI</big></big></big></big></strong></summary>
    <ul>   <li><strong>https://api.notifichedigitali.it:</strong></br>Ambiente di produzione</li> <li><strong>https://api.uat.notifichedigitali.it:</strong></br>Ambiente di collaudo</li> <li><strong>https://api.test.notifichedigitali.it:</strong></br>Ambiente di test. Potrebbe subire modifiche/integrazioni in futuro, rimanendo comunque non-bloccante e rispettando il principio di retro-attività</li> <li><strong>https://api.dev.notifichedigitali.it:</strong></br>Ambiente di sviluppo</li> </ul>   </details></br>
      
  contact:
    email: pn-supporto-enti@pagopa.it
  license:
    name: Licenza di PN
    url: https://notifichedigitali.pagopa.it/pubbliche-amministrazioni/index.html
servers:
  - url: https://api.notifichedigitali.it
    description: Ambiente di produzione
  - url: https://api.uat.notifichedigitali.it
    description: Ambiente di collaudo
  - url: https://api.test.notifichedigitali.it
    description: Ambiente di test
  - url: https://api.dev.notifichedigitali.it
    description: Ambiente di sviluppo
security:
  - ApiKeyAuth: []
tags:
  - name: HealthCheck
    description: 'Invocazioni per sapere lo stato di Piattaforma Notifiche # il servizio è ancora in fase di sviluppo'
  - name: NewNotification
    description: Invocazioni per effettuare il pre-caricamento dei documenti della notifica e inviare notifiche
  - name: SenderReadB2B
    description: Invocazioni utilizzabili dai mittenti per verificare lo stato delle richieste  di notifica inviate e delle notifiche accettate.
  - name: NotificationPrice
    description: Invocazioni per determinare il costo della notifica per il destinatario.
  - name: LegalFacts
    description: Invocazioni per effettuare il download degli atti opponibili a terzi
  - name: PaymentEvents
    description: Invocazioni per comunicare eventi di pagamento dalla PA
paths:
  /status:
    get:
      summary: status path
      description: status path per verificare lo stato di Piattaforma Notifiche
      tags:
        - HealthCheck
      operationId: status
      responses:
        '200':
          description: Ok
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/PnStatusResponse'
              example:
                functionalities:
                  - NOTIFICATION_CREATE
                  - NOTIFICATION_VISUALIZATION
                  - NOTIFICATION_WORKFLOW
                openIncidents: []
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/PnStatusResponse'
              example:
                functionalities:
                  - NOTIFICATION_CREATE
                  - NOTIFICATION_VISUALIZATION
                  - NOTIFICATION_WORKFLOW
                openIncidents:
                  - functionality: NOTIFICATION_CREATE
                    status: KO
                    startDate: '2019-08-24T14:15:22Z'
  /delivery/attachments/preload:
    post:
      summary: Richiesta di pre-caricamento dei documenti della notifica
      description: Operazione che richiede a Piattaforma Notifica le informazioni e le autorizzazioni necessarie  a precaricare uno o più file da allegare a una notifica. <br/>
      tags:
        - NewNotification
      operationId: presignedUploadRequest
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/PreLoadRequest'
              minItems: 1
              maxItems: 15
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PreLoadResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/v2/requests:
    post:
      summary: Richiesta invio notifica
      description: |-
        Operazione utilizzata dalla Pubblica Amministrazione per richiedere l'invio di una notifica.

        La restituzione di uno stato HTTP 202 significa solo che la richiesta è sintatticamente
        valida, non che la richiesta sia stata validata ed accettata. <br/>
        Per conoscere lo stato di accettazione della richiesta di notifica bisogna utilizzare l'operazione
        _getNotificationRequestStatus_ oppure utilizzare la modalità push prevista dai webhook. <br/>
      tags:
        - NewNotification
      operationId: sendNewNotificationV2
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewNotificationRequestV2'
        required: true
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewNotificationResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '409':
          description: Conflict
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
    get:
      operationId: retrieveNotificationRequestStatusV2
      tags:
        - SenderReadB2B
      summary: Verifica accettazione richiesta notifica
      description: Questa operazione serve per verificare se la richiesta di notifica è stata accettata e ottenere lo IUN associato a tale richiesta. <br/> Bisogna specificare il parametro _requestId_ oppure la coppia costituita dai parametri  _paProtocolNumber_ e _idempotenceToken_. <br/>
      parameters:
        - $ref: '#/components/parameters/notificationRequestId'
        - $ref: '#/components/parameters/paProtocolNumber'
        - $ref: '#/components/parameters/idempotenceToken'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewNotificationRequestStatusResponseV2'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/v2/notifications/sent/{iun}:
    get:
      summary: 'Mittente: lettura dettagli notifica'
      description: Questa operazione permette di leggere tutti i dettagli di una notifica accettata. <br/>
      tags:
        - SenderReadB2B
      operationId: retrieveSentNotificationV2
      parameters:
        - $ref: '#/components/parameters/pathIun'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FullSentNotificationV2'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/notifications/sent/{iun}/attachments/documents/{docIdx}:
    get:
      description: Download documento notificato
      summary: Download documento notificato
      tags:
        - SenderReadB2B
      operationId: retrieveSentNotificationDocument
      parameters:
        - $ref: '#/components/parameters/pathIun'
        - $ref: '#/components/parameters/pathDocumentIdx'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationAttachmentDownloadMetadataResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/notifications/sent/{iun}/attachments/payment/{recipientIdx}/{attachmentName}:
    get:
      description: Download allegato per pagamento
      summary: Download allegato per pagamento
      tags:
        - SenderReadB2B
      operationId: retrieveSentNotificationAttachment
      parameters:
        - $ref: '#/components/parameters/pathIun'
        - $ref: '#/components/parameters/pathRecipientIdx'
        - $ref: '#/components/parameters/pathAttachmentName'
        - $ref: '#/components/parameters/attachmentIdx'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationAttachmentDownloadMetadataResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery-push/{iun}/legal-facts/{legalFactType}/{legalFactId}:
    get:
      summary: Download atto opponibile a terzi
      description: Permette di scaricare un atto opponibile a terzi
      tags:
        - LegalFacts
      operationId: retrieveLegalFact
      parameters:
        - $ref: '#/components/parameters/pathIun'
        - $ref: '#/components/parameters/pathLegalFactType'
        - $ref: '#/components/parameters/pathLegalFactId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalFactDownloadMetadataResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery-push/{iun}/download/legal-facts/{legalFactId}:
    get:
      summary: Download atto opponibile a terzi
      description: Permette di scaricare un atto opponibile a terzi
      tags:
        - LegalFacts
      operationId: downloadLegalFactById
      parameters:
        - $ref: '#/components/parameters/pathIun'
        - $ref: '#/components/parameters/pathLegalFactId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalFactDownloadMetadataResponse'
        '400':
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/price/{paTaxId}/{noticeCode}:
    get:
      operationId: retrieveNotificationPrice
      summary: Retrieve notification price and effective date
      description: |-
        Usata dalla PA per recuperare il costo di notificazione tramite
         l'identificativo della posizione debitoria paTaxId e noticeCode.
      tags:
        - NotificationPrice
      parameters:
        - name: paTaxId
          description: Payment PA fiscal code
          in: path
          required: true
          example: '77777777777'
          schema:
            $ref: '#/components/schemas/paTaxId'
        - name: noticeCode
          description: Payment notice number  numero avviso
          in: path
          required: true
          example: '302000100000019421'
          schema:
            $ref: '#/components/schemas/noticeCode'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationPriceResponse'
        '400':
          description: Invalid input
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/events/payment/pagopa:
    post:
      operationId: paymentEventsRequestPagoPa
      description: Questa API è a disposizione della Pubblica Amministrazione per inviare eventi di chiusura di una o più posizioni debitorie di tipo PagoPA. <br/>
      tags:
        - PaymentEvents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentEventsRequestPagoPa'
      responses:
        '204':
          description: OK
        '400':
          description: Invalid input
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
  /delivery/events/payment/f24:
    post:
      deprecated: true
      operationId: paymentEventsRequestF24
      description: Questa API è a disposizione della Pubblica Amministrazione per inviare eventi di chiusura di una o più posizioni debitorie di tipo F24. <br/>
      tags:
        - PaymentEvents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentEventsRequestF24'
      responses:
        '204':
          description: OK
        '400':
          description: Invalid input
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '404':
          description: Not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
        '500':
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/Problem'
components:
  parameters:
    notificationRequestId:
      in: query
      required: false
      name: notificationRequestId
      description: identificativo della richiesta di notifica
      schema:
        type: string
        maxLength: 36
        pattern: ^[A-Za-z0-9+/=]{36}$
    paProtocolNumber:
      name: paProtocolNumber
      in: query
      required: false
      description: Numero di protocollo associato alla notifica, può essere riutilizzato per rettifiche.
      schema:
        type: string
        pattern: ^.*$
        maxLength: 256
    idempotenceToken:
      name: idempotenceToken
      description: 'token usato per disambiguare "richieste di notificazione" effettuate con lo stesso  numero di protocollo. '
      in: query
      required: false
      schema:
        type: string
        pattern: ^[ -~]*$
        maxLength: 256
    pathDocumentIdx:
      name: docIdx
      description: indice del documento nella lista partendo da 0.
      in: path
      required: true
      schema:
        type: integer
        format: int32
    pathRecipientIdx:
      name: recipientIdx
      description: indice del destinatario nella lista partendo da 0.
      in: path
      required: true
      schema:
        type: integer
        format: int32
    pathAttachmentName:
      name: attachmentName
      description: Tipologia del pagamento allegato alla notifica. Valori possibili PAGOPA|F24
      in: path
      required: true
      schema:
        type: string
        minLength: 3
        maxLength: 6
        pattern: PAGOPA|F24
    attachmentIdx:
      in: query
      name: attachmentIdx
      description: indice del documento di pagamento partendo da 0
      required: false
      schema:
        type: integer
        format: int32
    pathLegalFactType:
      description: Categoria dell'atto opponibile a terzi
      name: legalFactType
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/LegalFactCategory'
    pathLegalFactId:
      description: Identificativo dell'atto opponibile a terzi
      name: legalFactId
      in: path
      required: true
      schema:
        type: string
        pattern: ^[ -~]*$
        maxLength: 1024
    pathIun:
      description: Identificativo Univoco Notifica
      name: iun
      in: path
      required: true
      schema:
        type: string
        minLength: 25
        maxLength: 25
        pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
  schemas:
    PnStatusResponse:
      title: Stato attuale di PN
      description: Elenco delle funzionalità della piattaforma ed elenco dei disservizi noti e attivi  al momento della richiesta. I disservizi (_openIncidents_) segnalati sono al più uno  per funzionalità; gli attributi _endDate_ e _legalFactId_ non saranno valorizzati.
      type: object
      required:
        - functionalities
        - openIncidents
      properties:
        status:
          description: Bad Request
          example: 400
          exclusiveMaximum: true
          format: int32
          maximum: 600
          minimum: 100
          type: integer
        title:
          description: The server cannot process the request
          example: Bad Request
          maxLength: 64
          pattern: ^[ -~]{0,64}$
          type: string
        detail:
          description: The server cannot process the request
          example: Bad Request
          maxLength: 4096
          pattern: ^.{0,4096}$
          type: string
        functionalities:
          title: elenco funzionalità di PN
          description: Un array che comprende tutti i possibili valori dell'enum _PnFunctionality_
          type: array
          items:
            $ref: '#/components/schemas/PnFunctionality'
        openIncidents:
          title: elenco disservizi correnti
          description: Al più uno per funzionalità
          type: array
          items:
            $ref: '#/components/schemas/PnDowntimeEntry'
    PreLoadRequest:
      title: Richiesta di precaricamento di un File
      type: object
      required:
        - sha256
      properties:
        preloadIdx:
          title: Id della richiesta di precaricamento di un file
          description: Identificativo univoco all'interno della request HTTP, serve per correlare la risposta. Stringa alfanumerica con caratteri utilizzabili in un nome file.
          type: string
          minLength: 1
          maxLength: 512
          pattern: ^[a-zA-Z0-9._-]{1,512}$
        contentType:
          title: MIME type del file che verrà caricato
          description: |-
            Il MIME type dell'allegato che dovrà essere caricato. Attualmente sono supportati
              - application/pdf
              - application/json
          type: string
          minLength: 15
          maxLength: 16
          pattern: ^application\/(pdf|json)$
        sha256:
          title: checksum sha256 del file che verrà caricato
          description: checksum sha256, codificato in base 64, del contenuto binario del file che verrà caricato
          type: string
          example: jezIVxlG1M1woCSUngM6KipUN3/p8cG5RMIPnuEanlE=
          minLength: 44
          maxLength: 44
          pattern: ^[A-Za-z0-9+\/]{43}=|[A-Za-z0-9+\/]{44}$
    PreLoadResponse:
      title: Informazioni per il caricamento file
      description: Per ogni richiesta che è stata fatta viene fornito un presigned URL e le  informazioni per usarlo.
      type: object
      properties:
        preloadIdx:
          description: per correlazione con la richiesta. Stringa alfanumerica con caratteri utilizzabili in un file.
          type: string
          minLength: 1
          maxLength: 512
          pattern: ^[a-zA-Z0-9._-]{1,512}$
        secret:
          description: Token aggiuntivo per far si che sia necessario intercettare anche gli  header e non solo l'URL di upload del contenuto del documento.
          example: AZ23RF12
          type: string
        httpMethod:
          description: Indica se per l'upload del contenuto file bisogna utilizzare il metodo PUT o POST
          type: string
          example: PUT
          enum:
            - POST
            - PUT
        url:
          description: URL a cui effettuare l'upload del contenuto del documento.
          type: string
          example: https://preloadpn.aws.amazon.......
        key:
          description: la chiave restituita sarà globalmente unica e andrà utilizzata nella richiesta  di notifica.
          example: PN_NOTIFICATION_ATTACHMENTS-0001-301W-B9CB-9U72-WIKD
          type: string
    NotificationPriceResponse:
      title: Notification price Response
      description: Notification price and effective date
      type: object
      properties:
        iun:
          $ref: '#/components/schemas/IUN'
        amount:
          description: amount in euro cents
          type: integer
          format: int32
        refinementDate:
          description: data di perfezionamento per decorrenza termini localizzata espressa alla mezzanotte del giorno in cui si verifica l'evento
          type: string
          format: date-time
        notificationViewDate:
          description: data di perfezionamento per presa visione espressa alla mezzanotte del giorno in cui si verifica l'evento
          type: string
          format: date-time
    NewNotificationResponse:
      title: Identificativi della richiesta di notifica
      description: Contiene le informazioni per identificare una richiesta di invio notifica che non è ancora stata accettata da Piattaforma notifiche.
      type: object
      required:
        - notificationRequestId
        - paProtocolNumber
      properties:
        notificationRequestId:
          type: string
          description: identificativo univoco di una richiesta di invio notifica, non è lo IUN
          maxLength: 36
          pattern: ^[A-Za-z0-9+/=]{36}$
        paProtocolNumber:
          type: string
          description: Identificativo inviato dalla pubblica amministrazione
        idempotenceToken:
          description: Ripetizione del token usato per disambiguare "richieste di notificazione"  effettuate con lo stesso numero di protocollo (campo _paProtocolNumber_).
          type: string
    NewNotificationRequestStatusResponseV2:
      allOf:
        - $ref: '#/components/schemas/NewNotificationRequestV2'
        - type: object
          required:
            - notificationRequestId
            - notificationRequestStatus
          properties:
            notificationRequestId:
              description: identificativo univoco di una richiesta di invio notifica, non è lo IUN
              type: string
            notificationRequestStatus:
              description: '- __WAITING__: in attesa di essere valutata - __ACCEPTED__: richiesta di notifica accettata, lo IUN è valorizzato - __REFUSED__: richiesta di notifica rifiutata, è valorizzato il campo _errors_'
              type: string
            retryAfter:
              type: integer
              format: int32
              description: Numero di secondi da attendere prima di effettuare una nuova richiesta per  la stessa entità; valorizzato quando lo status è __WAITING__.
            iun:
              $ref: '#/components/schemas/IUN'
            errors:
              description: Elenco degli errori che hanno causato il rifiuto della richiesta di notifica
              type: array
              items:
                $ref: '#/components/schemas/ProblemError'
    Problem:
      properties:
        type:
          description: URI reference of type definition
          type: string
        status:
          description: The HTTP status code generated by the origin server for this occurrence of the problem.
          type: integer
          format: int32
          example: 503
          maximum: 600
          minimum: 100
          exclusiveMaximum: true
        title:
          description: A short, summary of the problem type. Written in english and readable
          example: Service Unavailable
          maxLength: 64
          pattern: ^[ -~]{0,64}$
          type: string
        detail:
          description: A human readable explanation of the problem.
          example: Request took too long to complete.
          maxLength: 4096
          pattern: ^.{0,4096}$
          type: string
        traceId:
          description: Internal support identifier associated to error
          example: 123e4567-e89b-12d3-a456-426614174000
          type: string
        timestamp:
          description: date and time referred to UTC
          example: '2022-07-27T12:22:33.444Z'
          type: string
          format: date-time
        errors:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/ProblemError'
      required:
        - status
        - errors
    ProblemError:
      properties:
        code:
          description: Internal code of the error, in human-readable format
          example: PN_PARAMETER_TOO_LONG | PN_PARAMETER_TOO_SHORT | PN_DUPLICATE_ENTRY | etc...
          type: string
        element:
          description: Parameter or request body field name for validation error
          example: body.order.item[2].quantity
          type: string
        detail:
          description: A human readable explanation specific to this occurrence of the problem.
          example: Parameter not valid
          maxLength: 1024
          type: string
      required:
        - code
    FullSentNotificationV2:
      description: Le informazioni riguardanti una notifica (richiesta di notifica accettata) e il  processo di inoltro della notifica verso il cittadino.
      allOf:
        - $ref: '#/components/schemas/SentNotificationV2'
        - type: object
          required:
            - notificationStatus
            - notificationStatusHistory
            - timeline
          properties:
            notificationStatus:
              $ref: '#/components/schemas/NotificationStatus'
            notificationStatusHistory:
              $ref: '#/components/schemas/NotificationStatusHistory'
            timeline:
              description: elenco dettagliato di tutto ciò che è accaduto durrante il processo di notifica
              type: array
              items:
                $ref: '#/components/schemas/TimelineElement'
    PaymentEventsRequestPagoPa:
      title: Invio eventi di pagamento da PA a PN
      description: Richiesta contenente un array di eventi di pagamento di tipo PagoPA di cui una Pubblica Amministrazione deve avvisare Piattaforma Notifiche.
      type: object
      required:
        - events
      properties:
        events:
          description: Elenco degli eventi di pagamento
          type: array
          items:
            $ref: '#/components/schemas/PaymentEventPagoPa'
    PaymentEventsRequestF24:
      title: Invio eventi di pagamento da PA a PN
      description: Richiesta contenente un array di eventi di pagamento di tipo F24 di cui una Pubblica Amministrazione deve avvisare Piattaforma Notifiche.
      type: object
      required:
        - events
      properties:
        events:
          description: Elenco degli eventi di pagamento
          type: array
          items:
            $ref: '#/components/schemas/PaymentEventF24'
    PaymentEventPagoPa:
      title: Evento di pagamento PagoPa
      description: |-
        Comprende: <br/>
          - _noticeCode_: "codice avviso pagoPA" di pagamento del sistema pagoPA, usato per pagamento online.<br/>
          - _creditorTaxId_: codice fiscale dell'ente a cui fa riferimento il "codice avviso pagoPA". <br/>
          - data e ora del pagamento. <br/>
          - importo del pagamento in eurocent. <br/>
      type: object
      required:
        - noticeCode
        - creditorTaxId
        - paymentDate
        - amount
      properties:
        noticeCode:
          $ref: '#/components/schemas/noticeCode'
        creditorTaxId:
          $ref: '#/components/schemas/paTaxId'
        paymentDate:
          type: string
          pattern: ^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(\.[0-9]+)?(Z|([+\-][0-9]{2}):([0-9]{2}))$
          description: data e ora in formato ISO 8601
        amount:
          type: integer
          format: int32
    PaymentEventF24:
      title: Evento di pagamento F24
      description: |-
        Comprende: <br/>
          - lo _IUN_ della notifica pagata, <br/>
          - data e ora del pagamento, <br/>
          - il codice fiscale del destinatario pagatore, <br/>
          - la tipologia del destinatario pagatore (PF / PG), <br/>
          - importo del pagamento in eurocent. <br/>
      type: object
      required:
        - iun
        - paymentDate
        - recipientTaxId
        - recipientType
        - amount
      properties:
        iun:
          type: string
          minLength: 25
          maxLength: 25
          pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
        paymentDate:
          type: string
          format: date-time
        recipientTaxId:
          $ref: '#/components/schemas/TaxId'
        recipientType:
          type: string
          minLength: 2
          maxLength: 2
          pattern: PF|PG
        amount:
          type: integer
          format: int32
    TimelineElement:
      type: object
      additionalProperties: false
      properties:
        elementId:
          type: string
          description: 'Identificativo dell''elemento di timeline: insieme allo IUN della notifica definisce in  maniera univoca l''elemento di timeline'
        timestamp:
          type: string
          description: Momento in cui avviene l'evento descritto in questo elemento di timeline
          format: date-time
        legalFactsIds:
          type: array
          items:
            $ref: '#/components/schemas/LegalFactsId'
          description: Chiavi dei documenti che provano l'effettivo accadimento dell'evento descritto in timeline. Questo elemento
        category:
          $ref: '#/components/schemas/TimelineElementCategory'
        details:
          $ref: '#/components/schemas/TimelineElementDetails'
    NotificationStatus:
      type: string
      description: |
        stato di avanzamento del processo di notifica:
          * `IN_VALIDATION` - notifica depositata in attesa di validazione
          * `ACCEPTED` - L'ente ha depositato la notifica con successo
          * `REFUSED` - Notifica rifiutata a seguito della validazione
          * `DELIVERING` - L'invio della notifica è in corso
          * `DELIVERED` - La notifica è stata consegnata a tutti i destinatari
          * `VIEWED` - Il destinatario ha letto la notifica entro il termine stabilito
          * `EFFECTIVE_DATE` - Il destinatario non ha letto la notifica entro il termine stabilito
          * `PAID` - Uno dei destinatari ha pagato la notifica
          * `UNREACHABLE` - Il destinatario non è reperibile
          * `CANCELLED` - L'ente ha annullato l'invio della notifica
      enum:
        - IN_VALIDATION
        - ACCEPTED
        - REFUSED
        - DELIVERING
        - DELIVERED
        - VIEWED
        - EFFECTIVE_DATE
        - PAID
        - UNREACHABLE
        - CANCELLED
    NotificationStatusHistory:
      description: elenco degli avanzamenti effettuati dal processo di notifica
      type: array
      items:
        $ref: '#/components/schemas/NotificationStatusHistoryElement'
    LegalFactDownloadMetadataResponse:
      title: Url e metadati per il download di un allegato di una notifica
      description: |-
        I due campi più importanti sono __url__ e __retryAfter__. <br/>
          - __url__ è presente se il file è pronto per essere scaricato ed indica l'url a cui fare GET.
          - __retryAfter__ indica che il file non è stato archiviato e bisognerà aspettare un numero di
            secondi non inferiore a quanto indicato dal campo _retryAfter_. <br/>
      type: object
      required:
        - filename
        - contentLength
      properties:
        filename:
          type: string
        contentLength:
          type: number
          format: decimal32
          example: 54092
          description: dimensione, in byte, del contenuto.
        url:
          type: string
          description: URL preautorizzato a cui effettuare una richiesta GET per ottenere il  contenuto del documento. Presente solo se il documento è pronto per il download.
        retryAfter:
          type: number
          format: decimal32
          description: Stima del numero di secondi da aspettare prima che il contenuto del  documento sia scaricabile.
    PnFunctionality:
      title: Funzionalità di PN
      description: |-
        - __NOTIFICATION_CREATE__: la possibilità di creare nuove notifiche.
        - __NOTIFICATION_VISUALIZATION__: la possibilità di visualizzare le notifiche e scaricare gli atti. 
        - __NOTIFICATION_WORKFLOW__: l'avanzamento del processo di notifica. 
      type: string
      enum:
        - NOTIFICATION_CREATE
        - NOTIFICATION_VISUALIZATION
        - NOTIFICATION_WORKFLOW
      x-enum-varnames:
        - NOTIFICATION_CREATE
        - NOTIFICATION_VISUALIZATION
        - NOTIFICATION_WORKFLOW
    PnFunctionalityStatus:
      type: string
      enum:
        - KO
        - OK
    PnDowntimeEntry:
      title: Dati relativi ad un disservizio di PN.
      type: object
      required:
        - functionality
        - status
        - startDate
      properties:
        functionality:
          $ref: '#/components/schemas/PnFunctionality'
        status:
          $ref: '#/components/schemas/PnFunctionalityStatus'
        startDate:
          title: data inizio disservizio
          type: string
          format: date-time
        endDate:
          title: data fine disservizio
          description: se il disservizio è ancora attivo questo campo sarà assente o con valore _null_
          type: string
          format: date-time
        legalFactId:
          title: id dell'atto opponibile a terzi
          description: Se assente o valorizzato _null_ indica che l'atto opponibile a terzi non è ancora disponibile. Questo avviene per i disservizi ancora aperti e per i disservizi  terminati da pochi minuti. <br/> Questo valore è da utilizzare con l'API _getLegalFact_ di questo stesso servizio.
          type: string
        fileAvailable:
          type: boolean
    TaxId:
      description: C.F. persona fisica o persona giuridica (Partita iva)
      type: string
      minLength: 11
      maxLength: 16
      pattern: ^([A-Z]{6}[0-9LMNPQRSTUV]{2}[A-Z]{1}[0-9LMNPQRSTUV]{2}[A-Z]{1}[0-9LMNPQRSTUV]{3}[A-Z]{1})|([0-9]{11})$
    Denomination:
      description: Denominazione ente o persona fisica / ragione sociale
      type: string
      minLength: 1
      maxLength: 80
      pattern: ^.*$
    NotificationDigitalAddress:
      description: Indirizzo di invio della notifica
      required:
        - address
        - type
      type: object
      properties:
        type:
          type: string
          description: tipo di indirizzo PEC, REM, SERCQ, ...
          enum:
            - PEC
        address:
          type: string
          example: account@domain.it
          description: Indirizzo PEC o REM che il mittente della notifica intende utilizzare per  raggiungere il destinatario.
          pattern: ^([a-zA-Z0-9]+(?:[.\-_][a-zA-Z0-9]+){0,10}@[a-zA-Z0-9]+(?:[.-][a-zA-Z0-9]+){0,10}(?:\.[a-zA-Z0-9]{2,10}))$
          maxLength: 320
    NotificationPhysicalAddress:
      description: Indirizzo fisico
      type: object
      required:
        - address
        - municipality
      properties:
        at:
          type: string
          description: Campo "presso" dell'indirizzo
          pattern: ^.*$
          maxLength: 256
        address:
          type: string
          description: Indirizzo del domicilio fisico
          pattern: ^.*$
          minLength: 2
          maxLength: 1024
        addressDetails:
          type: string
          description: Seconda riga dell'indirizzo fisico
          pattern: ^.*$
          maxLength: 1024
        zip:
          type: string
          description: Codice di avviamento postale. In caso di invio estero diventa facoltativo
          minLength: 0
          maxLength: 15
          pattern: ^(\w|\ |\-)*$
        municipality:
          type: string
          description: Comune
          pattern: ^.*$
          minLength: 2
          maxLength: 256
        municipalityDetails:
          type: string
          description: Frazione o località
          pattern: ^.*$
          maxLength: 256
        province:
          type: string
          description: Provincia
          pattern: ^.*$
          maxLength: 256
        foreignState:
          type: string
          description: Denominazione paese estero
          pattern: ^.*$
          maxLength: 256
    noticeCode:
      description: Payment notice number  numero avviso
      example: '302000100000019421'
      type: string
      maxLength: 18
      minLength: 18
      pattern: ^\d+$
    paTaxId:
      description: Payment PA fiscal code
      example: '77777777777'
      type: string
      maxLength: 11
      minLength: 11
      pattern: ^\d+$
    NotificationAttachmentDigests:
      description: Codici per la verifica del corretto caricamento di un allegato
      type: object
      required:
        - sha256
      properties:
        sha256:
          type: string
          description: Digest "sha256" della codifica binaria dell'allegato in base64
          example: jezIVxlG1M1woCSUngM6KipUN3/p8cG5RMIPnuEanlE=
          minLength: 44
          maxLength: 44
          pattern: ^[A-Za-z0-9+\/]{43}=|[A-Za-z0-9+\/]{44}$
    NotificationAttachmentBodyRef:
      description: Riferimento all'allegato precaricato
      required:
        - key
        - versionToken
      type: object
      properties:
        key:
          type: string
          description: Chiave in cui è stato salvato l'allegato
          maxLength: 512
          pattern: ^(safestorage:\/\/)?[A-Za-z0-9._-]+$
        versionToken:
          type: string
          description: Token per recuperare l'esatta istanza dell'allegato, che dovrà coincidere con l'__x-amz-version-id__ ottenuto nell'header della response in fase di upload del documento ad esso associato.
          pattern: ^.*$
          maxLength: 256
    NotificationAttachment:
      description: Un allegato della notifica.
      type: object
      required:
        - digests
        - contentType
        - ref
      properties:
        digests:
          $ref: '#/components/schemas/NotificationAttachmentDigests'
        contentType:
          type: string
          description: tipo di contenuto dell'allegato, supportato application/pdf
          minLength: 15
          maxLength: 15
          pattern: ^application\/pdf$
        ref:
          $ref: '#/components/schemas/NotificationAttachmentBodyRef'
    NotificationPaymentAttachment:
      description: Un modulo di pagamento allegato alla notifica
      allOf:
        - $ref: '#/components/schemas/NotificationAttachment'
    PagoPaPayment:
      title: Informazioni per effettuare il pagamento con sistema pagoPA
      description: |-
        Informazioni utili per effettuare il pagamento di una notifica, sono associate al destinatario perché le spese di notifica possono differire a seconda del canale di notifica utilizzato. <br/>
          - _noticeCode_: "codice avviso pagoPA" di pagamento del sistema pagoPA, usato per pagamento online.<br/>
          - _creditorTaxId_: codice fiscale dell'ente a cui fa riferimento il "codice avviso pagoPA". <br/>
          - _applyCost_: flag per indicare se l'avviso pagoPA deve contenere i costi di notifica. <br/>
          - _pagoPaForm_: riferimento al PDF contenete il bollettino pagoPA<br/>
      type: object
      required:
        - noticeCode
        - creditorTaxId
        - applyCost
      properties:
        noticeCode:
          $ref: '#/components/schemas/noticeCode'
        creditorTaxId:
          $ref: '#/components/schemas/paTaxId'
        applyCost:
          type: boolean
          nullable: false
          description: Flag per indicare se l'avviso pagoPa deve contere i costi di notifica
        attachment:
          $ref: '#/components/schemas/NotificationPaymentAttachment'
    NotificationMetadataAttachment:
      description: Un metadato allegato della notifica.
      type: object
      required:
        - digests
        - contentType
        - ref
      properties:
        digests:
          $ref: '#/components/schemas/NotificationAttachmentDigests'
        contentType:
          type: string
          description: tipo di contenuto dell'allegato, supportato application/json
          minLength: 16
          maxLength: 16
          pattern: ^application\/json$
        ref:
          $ref: '#/components/schemas/NotificationAttachmentBodyRef'
    F24Payment:
      title: Informazioni per effettuare il pagamento tramite modello F24
      description: |-
        Informazioni utili per effettuare il pagamento di una notifica, sono associate al destinatario perché le spese di notifica possono differire a seconda del canale di notifica utilizzato. <br/>
          - _title_: titolo del documento pdf da mostrare all'utente .<br/>
          - _applyCost_: flag per indicare se il modello F24 deve contenere i costi di notifica.<br/>
          - _metadataAttachment_: riferimento ai metadati per la generazione del modello F24.<br/>
      type: object
      required:
        - title
        - applyCost
        - metadataAttachment
      properties:
        title:
          description: Titolo del documento pdf da mostrare all'utente
          type: string
        applyCost:
          type: boolean
          nullable: false
          description: Flag per indicare se il modello F24 deve contere i costi di notifica
        metadataAttachment:
          $ref: '#/components/schemas/NotificationMetadataAttachment'
    NotificationPaymentItem:
      minProperties: 1
      properties:
        pagoPa:
          $ref: '#/components/schemas/PagoPaPayment'
        f24:
          $ref: '#/components/schemas/F24Payment'
    NotificationPayments:
      title: Pagamenti collegati alla notifica per il destinatario
      description: Lista dei pagamenti collegati alla notifica per il destinatario. Possono essere pagamenti rateali o alternativi
      type: array
      items:
        $ref: '#/components/schemas/NotificationPaymentItem'
    NotificationRecipientV2:
      description: Informazioni sui destinatari
      required:
        - denomination
        - recipientType
        - taxId
        - physicalAddress
      type: object
      properties:
        recipientType:
          type: string
          description: 'Tipologia di destinatario: Persona Fisica (PF) o Persona Giuridica (PG)'
          enum:
            - PF
            - PG
        taxId:
          $ref: '#/components/schemas/TaxId'
        denomination:
          $ref: '#/components/schemas/Denomination'
        digitalDomicile:
          $ref: '#/components/schemas/NotificationDigitalAddress'
        physicalAddress:
          $ref: '#/components/schemas/NotificationPhysicalAddress'
        payments:
          $ref: '#/components/schemas/NotificationPayments'
    NotificationDocument:
      description: Un documento da notificare
      allOf:
        - $ref: '#/components/schemas/NotificationAttachment'
        - type: object
          properties:
            title:
              type: string
              description: Titolo del documento allegato. Stringa alfanumerica con caratteri utilizzabili in un nome file.
              minLength: 1
              maxLength: 512
              pattern: ^.*$
            docIdx:
              type: string
              description: Indice del documento partendo da 0.
              maxLength: 3
              pattern: ^\d+$
    NotificationFeePolicy:
      type: string
      description: 'Politica di addebitamento dei costi di notifica. <br/> - _FLAT_RATE_: costo forfettario fisso. <br/> - _DELIVERY_MODE_: costo calcolato in base all''effettivo percorso di notifica. <br/>'
      enum:
        - FLAT_RATE
        - DELIVERY_MODE
    IUN:
      description: Identificativo Univoco Notifica
      type: string
      minLength: 25
      maxLength: 25
      pattern: ^[A-Z]{4}-[A-Z]{4}-[A-Z]{4}-[0-9]{6}-[A-Z]{1}-[0-9]{1}$
    NewNotificationRequestV2:
      description: I campi utilizzati per la creazione di una nuova Notifica.
      type: object
      required:
        - paProtocolNumber
        - subject
        - recipients
        - documents
        - physicalCommunicationType
        - notificationFeePolicy
        - senderDenomination
        - senderTaxId
      properties:
        idempotenceToken:
          description: Identificativo utilizzabile dal chiamante per disambiguare differenti  "richieste di notificazione" effettuate con lo stesso numero di protocollo  (campo _paProtocolNumber_). Questo può essere necessario in caso di  "richiesta di notifica" rifiutata per errori nei codici di verifica degli allegati.
          type: string
          pattern: ^[ -~]*$
          maxLength: 256
        paProtocolNumber:
          description: Numero di protocollo che la PA mittente assegna alla notifica stessa
          type: string
          pattern: ^.*$
          maxLength: 256
        subject:
          type: string
          description: titolo della notifica
          maxLength: 134
          pattern: ^.*$
        abstract:
          type: string
          description: descrizione sintetica della notifica
          pattern: ^.*$
          maxLength: 1024
        recipients:
          type: array
          description: Informazioni sui destinatari
          items:
            $ref: '#/components/schemas/NotificationRecipientV2'
        documents:
          type: array
          description: Documenti notificati
          items:
            $ref: '#/components/schemas/NotificationDocument'
          minItems: 1
        notificationFeePolicy:
          $ref: '#/components/schemas/NotificationFeePolicy'
        cancelledIun:
          $ref: '#/components/schemas/IUN'
        physicalCommunicationType:
          type: string
          description: Tipologia comunicazione fisica
          enum:
            - AR_REGISTERED_LETTER
            - REGISTERED_LETTER_890
        senderDenomination:
          $ref: '#/components/schemas/Denomination'
        senderTaxId:
          $ref: '#/components/schemas/paTaxId'
        group:
          type: string
          description: Gruppo di utenti dell'ente mittente che può visualizzare la notifica
          pattern: ^[ -~]*$
          maxLength: 1024
        amount:
          type: integer
          format: int32
          description: Importo della notifica in eurocent
        paymentExpirationDate:
          type: string
          minLength: 10
          maxLength: 10
          pattern: ^([0-9]{4})-(1[0-2]|0[1-9])-(3[01]|[12][0-9]|0[1-9])$
          description: Data di scadenza del pagamento nel formato YYYY-MM-DD riferito all'Italia
        taxonomyCode:
          type: string
          minLength: 7
          maxLength: 7
          pattern: ^([0-9]{6}[A-Z]{1})$
          description: Codice tassonomico della notifica basato sulla definizione presente nell'allegato 2 capitolo C del bando [__AVVISO PUBBLICO MISURA 1.4.5 PIATTAFORMA NOTIFICHE DIGITALI__](https://pnrrcomuni.fondazioneifel.it/bandi_public/Bando/325)
          default: 010101P
        paFee:
          type: integer
          description: Costo espresso in eurocent che la PA imputa per la notifica
          format: int32
          minimum: 0
          maximum: 100
        vat:
          type: integer
          format: int32
          description: IVA espressa in percentuale imposta al mittente sulla notifica analogica
        pagoPaIntMode:
          type: string
          description: 'Modalitá di integrazione pagoPA per l''attualizazione del costo della notifica. <br/> - _NONE_: nessuna attualizzazione. <br/> - _SYNC_: modalitá sincrona. <br/> - _ASYNC_: modalitá asincrona. (non ancora supportata)<br/>'
          enum:
            - NONE
            - SYNC
            - ASYNC
    SentNotificationV2:
      description: Le informazioni riguardanti una richiesta di notifica accettata
      allOf:
        - $ref: '#/components/schemas/NewNotificationRequestV2'
        - type: object
          required:
            - iun
            - sentAt
          properties:
            senderPaId:
              type: string
              description: Identificativo (non IPA) della PA mittente che ha eseguito l'onboarding su SelfCare.
              pattern: ^.*$
              maxLength: 256
            iun:
              $ref: '#/components/schemas/IUN'
            sentAt:
              type: string
              description: Momento di ricezione della notifica da parte di PN
              format: date-time
            cancelledByIun:
              $ref: '#/components/schemas/IUN'
            documentsAvailable:
              type: boolean
              description: Indica se i documenti notificati sono ancora disponibili.
    TimelineElementId:
      type: string
    NotificationStatusHistoryElement:
      description: elenco degli avanzamenti effettuati dal processo di notifica
      type: object
      required:
        - status
        - activeFrom
        - relatedTimelineElements
      properties:
        status:
          $ref: '#/components/schemas/NotificationStatus'
        activeFrom:
          type: string
          description: data e ora di raggiungimento dello stato di avanzamento
          format: date-time
        relatedTimelineElements:
          type: array
          description: Eventi avvenuti nello stato
          items:
            $ref: '#/components/schemas/TimelineElementId'
    LegalFactCategory:
      title: Tipi di atti opponibili a terzi
      description: |-
        Tipi di atti opponibili a terzi che Piattaforma Notifiche mette a disposizione dei suoi utenti.
          - _SENDER_ACK_: atto di "presa in carico" di una notifica
          - _DIGITAL_DELIVERY_: ...
      type: string
      enum:
        - SENDER_ACK
        - DIGITAL_DELIVERY
        - ANALOG_DELIVERY
        - RECIPIENT_ACCESS
        - PEC_RECEIPT
        - ANALOG_FAILURE_DELIVERY
    LegalFactsId:
      description: Chiavi dei documenti generati durante il processo di consegna cartacea
      type: object
      required:
        - key
        - category
      properties:
        key:
          description: Chiave dell'atto opponibile a terzi generato durante il processo di consegna
          type: string
          pattern: ^(safestorage:\/\/)?[A-Za-z0-9._-]+$
          maxLength: 512
        category:
          $ref: '#/components/schemas/LegalFactCategory'
    TimelineElementCategory:
      type: string
      description: |
        stato di avanzamento del processo di notifica:`
          * `SENDER_ACK_CREATION_REQUEST` - Invio della richiesta di creazione dell'atto opponibile a terzi di presa in carico per il mittente a safe storage
          * `VALIDATE_NORMALIZE_ADDRESSES_REQUEST` - Invio della richiesta di validazione e normalizzazione indirizzi fisici presenti nella richiesta di notifica
          * `NORMALIZED_ADDRESS` - Salvataggio indirizzi normalizzati
          * `REQUEST_ACCEPTED` - Richiesta di notifica accettata a seguito dei controlli di validazione
          * `REQUEST_REFUSED` - Richiesta di notifica rifiutata per fallimento di validazione
          * `SEND_COURTESY_MESSAGE` - Invio di un messaggio di cortesia
          * `GET_ADDRESS` - Disponibilità dell’indirizzo specifico (domicilio digitale di piattaforma, domicilio digitale speciale, domicilio digitale generale, indirizzo fisico sulla notifica o sui registri nazionali)
          * `PUBLIC_REGISTRY_CALL` - Richiesta ai registri pubblici per ottenere domicilio digitale generale o per ottenere indirizzo fisico da ANPR, da registro della imprese, da anagrafe tributaria.
          * `PUBLIC_REGISTRY_RESPONSE` - Ricevuta la risposta dei registri pubblici
          * `SCHEDULE_ANALOG_WORKFLOW` - Pianificazione del workflow per invio cartaceo
          * `SCHEDULE_DIGITAL_WORKFLOW` -Pianificazione del workflow per invio digitale (PEC) del secondo tentativo in caso di fallimento del primo.
          * `PREPARE_DIGITAL_DOMICILE` - Preparazione per l’invio dell’avviso digitale.Va a valutare la timeline per capire quale sarà il prossimo indirizzo da usare.
          * `SEND_DIGITAL_DOMICILE` - Invio digitale dell’avviso di notifica
          * `SEND_DIGITAL_PROGRESS` - Tentativo di Invio PEC ad un determinato indirizzo.
          * `SEND_DIGITAL_FEEDBACK` - Ottenuto esito ad un invio digitale
          * `SCHEDULE_REFINEMENT` - Pianificato il perfezionamento per decorrenza termini
          * `REFINEMENT` - Perfezionamento per decorrenza termini
          * `DIGITAL_DELIVERY_CREATION_REQUEST` - Invio della richiesta di creazione dell'atto opponibile a terzi di chiusura del workflow digitale a safe storage
          * `DIGITAL_SUCCESS_WORKFLOW` - Completato con successo il workflow di invio digitale
          * `DIGITAL_FAILURE_WORKFLOW` - Completato con fallimento il workflow di invio digitale: tutti i tentativi di invio ai domicili digitali sono falliti.
          * `ANALOG_SUCCESS_WORKFLOW` - Completato con successo il workflow di invio cartaceo 
          * `ANALOG_FAILURE_WORKFLOW` - Completato con fallimento il workflow di invio cartaceo NOTA: se per tutti i destinatari si conclude il workflow con fallimento verrà scatenato l’evento COMPLETELY_UNREACHABLE
          * `PREPARE_SIMPLE_REGISTERED_LETTER` - Invio richiesta di prepare (preparazione ad invio) raccomandata semplice a paperChannel
          * `SEND_SIMPLE_REGISTERED_LETTER` - Invio di raccomandata semplice
          * `SEND_SIMPLE_REGISTERED_LETTER_PROGRESS` - Ricezione informazioni intermedia relative ad una notificazione cartacea semplice
          * `NOTIFICATION_VIEWED_CREATION_REQUEST` - Invio della richiesta di creazione dell'atto opponibile a terzi di presa visione a safe storage
          * `NOTIFICATION_VIEWED` - Visualizzazione della notifica (perfeziona la notifica se non già perfezionata per decorrenza termini o da altro destinatario)
          * `PREPARE_ANALOG_DOMICILE` - Invio richiesta di prepare (preparazione ad invio) cartaceo a paperChannel
          * `SEND_ANALOG_DOMICILE` - Invio cartaceo dell’avviso di notifica
          * `SEND_ANALOG_PROGRESS` - Ricezione informazioni intermedia relative ad una notificazione cartacea
          * `SEND_ANALOG_FEEDBACK` - Ricezione esito dell'invio cartaceo
          * `COMPLETELY_UNREACHABLE_CREATION_REQUEST` - Invio della richiesta di creazione dell'atto (simile a opponibile a terzi) di completamento con fallimento del workflow di invio cartaceo
          * `COMPLETELY_UNREACHABLE` - Tutti i destinatari risultano irraggiungibili
          * `AAR_CREATION_REQUEST` - Invio della richiesta di creazione dell'AAR (Avviso di Avvenuta Ricezione) a safe storage 
          * `AAR_GENERATION` - Generazione dell’AAR (Avviso di Avvenuta Ricezione)
          * `PAYMENT` - Ricezione pagamento della notifica
          * `NOT_HANDLED` - Per la sperimentazione l'invio analogico non è previsto, viene inserito tale elemento di timeline
          * `PROBABLE_SCHEDULING_ANALOG_DATE` - Data probabile di inizio del flusso analogico
      enum:
        - SENDER_ACK_CREATION_REQUEST
        - VALIDATE_NORMALIZE_ADDRESSES_REQUEST
        - NORMALIZED_ADDRESS
        - REQUEST_ACCEPTED
        - SEND_COURTESY_MESSAGE
        - GET_ADDRESS
        - PUBLIC_REGISTRY_CALL
        - PUBLIC_REGISTRY_RESPONSE
        - SCHEDULE_ANALOG_WORKFLOW
        - SCHEDULE_DIGITAL_WORKFLOW
        - PREPARE_DIGITAL_DOMICILE
        - SEND_DIGITAL_DOMICILE
        - SEND_DIGITAL_PROGRESS
        - SEND_DIGITAL_FEEDBACK
        - REFINEMENT
        - SCHEDULE_REFINEMENT
        - DIGITAL_DELIVERY_CREATION_REQUEST
        - DIGITAL_SUCCESS_WORKFLOW
        - DIGITAL_FAILURE_WORKFLOW
        - ANALOG_SUCCESS_WORKFLOW
        - ANALOG_FAILURE_WORKFLOW
        - PREPARE_SIMPLE_REGISTERED_LETTER
        - SEND_SIMPLE_REGISTERED_LETTER
        - SEND_SIMPLE_REGISTERED_LETTER_PROGRESS
        - NOTIFICATION_VIEWED_CREATION_REQUEST
        - NOTIFICATION_VIEWED
        - PREPARE_ANALOG_DOMICILE
        - SEND_ANALOG_DOMICILE
        - SEND_ANALOG_PROGRESS
        - SEND_ANALOG_FEEDBACK
        - PAYMENT
        - COMPLETELY_UNREACHABLE
        - COMPLETELY_UNREACHABLE_CREATION_REQUEST
        - REQUEST_REFUSED
        - AAR_CREATION_REQUEST
        - AAR_GENERATION
        - NOT_HANDLED
        - PROBABLE_SCHEDULING_ANALOG_DATE
    SenderAckCreationRequestDetails:
      type: object
      properties:
        legalFactId:
          type: string
          description: Identificativo dell'atto opponibile a terzi del quale è stata richiesta la creazione
    PhysicalAddress:
      type: object
      required:
        - address
        - municipality
      properties:
        at:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Campo "presso" dell'indirizzo
        address:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Indirizzo del domicilio fisico
        addressDetails:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Seconda riga dell'indirizzo fisico
        zip:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Codice di avviamento postale. In caso di invio estero diventa facoltativo
        municipality:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Comune in cui l'indirizzo si trova
        municipalityDetails:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Frazione o località
        province:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Provincia in cui si trova l'indirizzo
        foreignState:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: Denominazione paese estero
      description: Indirizzo fisico scoperto durante fase di consegna
    NormalizedAddressDetails:
      type: object
      required:
        - recIndex
        - oldAddress
        - normalizedAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        oldAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        normalizedAddress:
          $ref: '#/components/schemas/PhysicalAddress'
    NotificationRequestAcceptedDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
    AnalogFailureWorkflowDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        generatedAarUrl:
          type: string
          description: Chiave per recupero da safe-storage del documento aar
    AnalogSuccessWorkflowDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
    EndWorkflowStatus:
      type: string
      description: Stato chiusura workflow
      enum:
        - SUCCESS
        - FAILURE
    CompletelyUnreachableCreationRequestDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        legalfactId:
          type: string
          description: Identificativo dell'atto opponibile a terzi del quale è stata richiesta la creazione
        endWorkflowStatus:
          $ref: '#/components/schemas/EndWorkflowStatus'
        completionWorkflowDate:
          type: string
          description: Data chiusura workflow
          format: date-time
    CompletelyUnreachableDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        legalFactGenerationDate:
          type: string
          description: Data generazione atto opponibile a terzi allegato
          format: date-time
    DigitalAddress:
      description: Indirizzo di invio della notifica
      required:
        - address
        - type
      type: object
      properties:
        type:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: tipo di indirizzo PEC, REM, SERCQ, ...
        address:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
          description: account@domain
    DigitalDeliveryCreationRequestDetails:
      type: object
      required:
        - recIndex
        - digitalAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        endWorkflowStatus:
          $ref: '#/components/schemas/EndWorkflowStatus'
        completionWorkflowDate:
          type: string
          description: Data chiusura workflow
          format: date-time
        legalfactId:
          type: string
          description: Identificativo dell'atto opponibile a terzi del quale è stata richiesta la creazione
    DigitalFailureWorkflowDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
    DigitalSuccessWorkflowDetails:
      type: object
      required:
        - recIndex
        - digitalAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
    DigitalAddressSource:
      type: string
      description: sorgente indirizzo di invio della notifica
      enum:
        - PLATFORM
        - SPECIAL
        - GENERAL
    GetAddressInfoDetails:
      type: object
      required:
        - recIndex
        - digitalAddressSource
        - isAvailable
        - attemptDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        isAvailable:
          type: boolean
          description: Disponibilità indirizzo
        attemptDate:
          type: string
          description: Data tentativo
          format: date-time
    RaddType:
      type: string
      description: |
        tipo di Rete Anti Digital Divide <br/>
        __FSU__: Fornitore Servizio Universale <br/>
    RaddTransactionId:
      type: string
      description: Identificativo della pratica all'interno della rete RADD
    RecipientType:
      type: string
      enum:
        - PF
        - PG
    DelegateInfo:
      type: object
      properties:
        internalId:
          type: string
        taxId:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
        operatorUuid:
          type: string
        mandateId:
          type: string
        denomination:
          x-field-extra-annotation: '@lombok.ToString.Exclude'
          type: string
        delegateType:
          $ref: '#/components/schemas/RecipientType'
    NotificationViewedCreationRequestDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        legalfactId:
          type: string
          description: Identificativo dell'atto opponibile a terzi del quale è stata richiesta la creazione
        eventTimestamp:
          type: string
          description: Data ricezione richiesta visualizzazione notifica
          format: date-time
        raddType:
          $ref: '#/components/schemas/RaddType'
        raddTransactionId:
          $ref: '#/components/schemas/RaddTransactionId'
        delegateInfo:
          $ref: '#/components/schemas/DelegateInfo'
    NotificationViewedDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        notificationCost:
          description: costo notifica in euro cents, può essere nullo se la notifica si è perfezionata prima per decorrenza termini
          example: 1220
          type: integer
          format: int64
        raddType:
          $ref: '#/components/schemas/RaddType'
        raddTransactionId:
          $ref: '#/components/schemas/RaddTransactionId'
        delegateInfo:
          $ref: '#/components/schemas/DelegateInfo'
    DeliveryMode:
      type: string
      description: Tipologia Domiciliazione
      enum:
        - DIGITAL
        - ANALOG
    ContactPhase:
      type: string
      description: Fase in cui è avvenuta la richiesta
      enum:
        - CHOOSE_DELIVERY
        - SEND_ATTEMPT
    PublicRegistryCallDetails:
      type: object
      required:
        - recIndex
        - deliveryMode
        - contactPhase
        - sentAttemptMade
        - sendDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        deliveryMode:
          $ref: '#/components/schemas/DeliveryMode'
        contactPhase:
          $ref: '#/components/schemas/ContactPhase'
        sentAttemptMade:
          type: integer
          description: Numero di tentativi di notificazione già effettuati
          format: int32
        sendDate:
          type: string
          description: Data invio richiesta ai public registry
          format: date-time
    PublicRegistryResponseDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
    RefinementDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        notificationCost:
          description: costo notifica in euro cents, può essere nullo se la notifica si è perfezionata prima per visualizzazione
          example: 1220
          type: integer
          format: int64
    NotificationRefusedError:
      type: object
      properties:
        errorCode:
          type: string
          description: |-
            Errori di rifiuto della notifica.
              - FILE_NOTFOUND
              - FILE_SHA_ERROR
              - TAXID_NOT_VALID
              - SERVICE_UNAVAILABLE
              - FILE_PDF_INVALID_ERROR
              - FILE_PDF_TOOBIG_ERROR
              - NOT_VALID_ADDRESS
              - RECIPIENT_ID_NOT_VALID
        detail:
          type: string
    RequestRefusedDetails:
      type: object
      properties:
        refusalReasons:
          type: array
          description: Motivazioni che hanno portato al rifiuto della notifica
          items:
            $ref: '#/components/schemas/NotificationRefusedError'
    ScheduleAnalogWorkflowDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
    ScheduleDigitalWorkflowDetails:
      type: object
      required:
        - recIndex
        - digitalAddressSource
        - sentAttemptMade
        - lastAttemptDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        sentAttemptMade:
          type: integer
          format: int32
        lastAttemptDate:
          type: string
          format: date-time
    ScheduleRefinementDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        schedulingDate:
          type: string
          format: date-time
    IoSendMessageResult:
      type: string
      description: Risultato invio messaggio su IO
      enum:
        - NOT_SENT_OPTIN_ALREADY_SENT
        - SENT_COURTESY
        - SENT_OPTIN
    SendCourtesyMessageDetails:
      type: object
      required:
        - recIndex
        - digitalAddress
        - sendDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        sendDate:
          type: string
          description: data invio messaggio di cortesia
          format: date-time
        ioSendMessageResult:
          $ref: '#/components/schemas/IoSendMessageResult'
    PrepareDigitalDetails:
      type: object
      required:
        - recIndex
        - digitalAddressSource
        - retryNumber
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        attemptDate:
          type: string
          description: data tentativo precedente
          format: date-time
        nextDigitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        nextSourceAttemptsMade:
          type: integer
          description: numero del prossimo tentativo da effettuare
          format: int32
        nextLastAttemptMadeForSource:
          type: string
          description: data tentativo precedente per prossimo source
          format: date-time
    SendDigitalDetails:
      type: object
      required:
        - recIndex
        - digitalAddress
        - digitalAddressSource
        - retryNumber
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
    ResponseStatus:
      type: string
      description: stato risposta ricevuta da externalChannel
      enum:
        - OK
        - KO
    SendingReceipt:
      type: object
      properties:
        id:
          type: string
        system:
          type: string
    SendDigitalFeedbackDetails:
      type: object
      required:
        - recIndex
        - digitalAddress
        - responseStatus
        - notificationDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        responseStatus:
          $ref: '#/components/schemas/ResponseStatus'
        notificationDate:
          type: string
          description: data notifica
          format: date-time
        deliveryFailureCause:
          description: Codice errore, vuoto in caso di successo
          type: string
        deliveryDetailCode:
          type: string
          description: |
            Stato - Codice relativo all'evento - Descrizione:
              - PROGRESS   C000 = PREACCETTAZIONE
              - PROGRESS   C001 = ACCETTAZIONE
              - PROGRESS   C005 = PRESA_IN_CARICO
              - PROGRESS   C007 = PREAVVISO_ERRORE_CONSEGNA
              - PROGRESS   DP00 = RE-INVIO PEC CAUSA FALLIMENTO TEMPORANEO
              - PROGRESS   DP10 = TIMEOUT RICEZIONE RISULTATO
              - ERROR      C002 = NON_ACCETTAZIONE
              - ERROR      C004 = ERRORE_CONSEGNA
              - ERROR      C006 = RILEVAZIONE_VIRUS
              - ERROR      C008 = ERRORE_COMUNICAZIONE_SERVER_PEC
              - ERROR      C009 = ERRORE_DOMINIO_PEC_NON_VALIDO
              - ERROR      C010 = ERROR_INVIO_PEC
              - OK         C003 = AVVENUTA_CONSEGNA
        sendingReceipts:
          type: array
          items:
            $ref: '#/components/schemas/SendingReceipt'
    SendDigitalProgressDetails:
      type: object
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        deliveryFailureCause:
          description: Codice errore, opzionale
          type: string
        deliveryDetailCode:
          type: string
          description: Vedi deliveryDetailCode in SendDigitalFeedbackDetails
        shouldRetry:
          type: boolean
          description: indica se il progress ha dato luogo ad un ritentativo
        digitalAddress:
          $ref: '#/components/schemas/DigitalAddress'
        digitalAddressSource:
          $ref: '#/components/schemas/DigitalAddressSource'
        notificationDate:
          type: string
          description: data notifica
          format: date-time
        sendingReceipts:
          type: array
          items:
            $ref: '#/components/schemas/SendingReceipt'
        retryNumber:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
    ServiceLevel:
      type: string
      description: Livello Servizio
      enum:
        - AR_REGISTERED_LETTER
        - REGISTERED_LETTER_890
    BaseAnalogDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
        - serviceLevel
        - sentAttemptMade
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        serviceLevel:
          $ref: '#/components/schemas/ServiceLevel'
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        relatedRequestId:
          type: string
          description: Id relativo alla eventuale precedente richiesta di invio cartaceo
    SendAnalogDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
        - serviceLevel
        - sentAttemptMade
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        serviceLevel:
          $ref: '#/components/schemas/ServiceLevel'
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        relatedRequestId:
          type: string
          description: Id relativo alla eventuale precedente richiesta di invio cartaceo
        productType:
          type: string
          description: |
            Tipo di invio cartaceo effettivamente inviato
              - __AR__: Raccomandata nazionale Andata e Ritorno
              - __890__: Recapito a norma della legge 890/1982
              - __RIR__: Raccomandata internazionale Andata e Ritorno
        analogCost:
          type: integer
          description: costo in eurocent dell'invio
          format: int32
        numberOfPages:
          type: integer
          description: numero delle pagina che compongono la spedizione cartacea
          format: int32
        envelopeWeight:
          type: integer
          description: peso in grammi della busta
          format: int32
        prepareRequestId:
          type: string
          description: request id della relativa richiesta di prepare
    AttachmentDetails:
      type: object
      properties:
        id:
          type: string
        documentType:
          type: string
          description: |
            Codici documentType: - Plico: Indica il plico cartaceo - AR: Indica la ricevuta di ritorno - Indagine: Indica la ricevuta dell'analisi dell'indagine - 23L: Indica la ricevuta 23L
        url:
          type: string
        date:
          type: string
          format: date-time
    SendAnalogFeedbackDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
        - serviceLevel
        - sentAttemptMade
        - responseStatus
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        serviceLevel:
          $ref: '#/components/schemas/ServiceLevel'
        sentAttemptMade:
          type: integer
          description: numero dei tentativi effettuati
          format: int32
        newAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        responseStatus:
          $ref: '#/components/schemas/ResponseStatus'
        notificationDate:
          type: string
          format: date-time
        deliveryFailureCause:
          type: string
          description: |
            __Motivazione di mancata consegna__ obbligatorie negli stati di mancata consegna
              - __M01__ destinatario irreperibile
              - __M02__ destinatario deceduto
              - __M03__ destinatario sconosciuto
              - __M04__ destinatario trasferito
              - __M05__ invio rifiutato
              - __M06__ indirizzo inesatto
              - __M07__ indirizzo inesistente
              - __M08__ indirizzo insufficiente
              - __F01__ - in caso di furto
              - __F02__ - in caso di smarrimento
              - __F03__ - in caso di deterioramento
        deliveryDetailCode:
          type: string
          description: |
            Formato: - __deliveryDetailCode__- [prodotto] - [statusCode] - statusDescription
              - __CON080__- [ALL] - [PROGRESS] - Stampato ed Imbustato
              - __RECRS001C__- [RS] - [OK] - Consegnato - Fascicolo Chiuso
              - __RECRS002C__- [RS] - [KO] - Mancata consegna - Fascicolo Chiuso
              - __RECRS002F__- [RS] - [KO] - Irreperibilità Assoluta - Fascicolo Chiuso
              - __RECRS003C__- [RS] - [OK] - Consegnato presso Punti di Giacenza - Fascicolo Chiuso
              - __RECRS004C__- [RS] - [OK] - Mancata consegna presso Punti di Giacenza - Fascicolo Chiuso
              - __RECRS005C__- [RS] - [OK] - Compiuta giacenza - Fascicolo Chiuso
              - __RECRS006__- [RS] - [PROGRESS] - Furto/Smarrimento/deterioramento
              - __RECRN001C__- [AR] - [OK] - Consegnato - Fascicolo Chiuso
              - __RECRN002C__- [AR] - [KO] - Mancata consegna - Fascicolo Chiuso
              - __RECRN002F__- [AR] - [KO] - Irreperibilità Assoluta - Fascicolo Chiuso
              - __RECRN003C__- [AR] - [OK] - Consegnato presso Punti di Giacenza - Fascicolo Chiuso
              - __RECRN004C__- [AR] - [KO] - Mancata consegna presso Punti di Giacenza - Fascicolo Chiuso
              - __RECRN005C__- [AR] - [OK] - Compiuta giacenza - Fascicolo Chiuso
              - __RECRN006__- [AR] - [PROGRESS] - Furto/Smarrimento/deterioramento
              - __RECAG001C__- [890] - [OK] - Consegnato - Fascicolo Chiuso
              - __RECAG002C__- [890] - [OK] - Consegnato a persona abilitata - Fascicolo Chiuso
              - __RECAG003C__- [890] - [KO] - Mancata consegna - Fascicolo Chiuso
              - __RECAG003F__- [890] - [KO] - Irreperibilità Assoluta - Fascicolo Chiuso
              - __RECAG004__- [890] - [PROGRESS] - Furto/Smarrimento/deterioramento
              - __RECAG005C__- [890] - [OK | PROGRESS] - Consegnato presso Punti di Giacenza - Fascicolo Chiuso
              - __RECAG006C__- [890] - [OK | PROGRESS] - Consegna a persona abilitata presso Punti di Giacenza - Fas. Ch.
              - __RECAG007C__- [890] - [KO | PROGRESS] - Mancata consegna presso Punti di Giacenza - Fascicolo Chiuso
              - __RECAG008C__- [890] - [PROGRESS] - Compiuta giacenza - Fascicolo Chiuso
              - __PNAG012__- [890] - [KO] - Distacco d'ufficio 23L - Fascicolo Chiuso
              - __RECRI003C__- [RIR] - [OK] - Consegnato - Fascicolo Chiuso
              - __RECRI004C__- [RIR] - [KO] - Non Consegnato - fascicolo Chiuso
              - __RECRI005__- [RIR] - [PROGRESS] - Furto/Smarrimento/deterioramento
              - __RECRSI003C__- [RIS] - [OK] - Consegnato - Fascicolo Chiuso
              - __RECRSI004C__- [RIS] - [KO] - Non Consegnato - fascicolo Chiuso
              - __RECRSI005__- [RIS] - [PROGRESS] - Furto/Smarrimento/deterioramento
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/AttachmentDetails'
        sendRequestId:
          type: string
          description: RequestId della richiesta d'invio
        registeredLetterCode:
          type: string
          description: Codice della raccomandata
    BaseRegisteredLetterDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
    SimpleRegisteredLetterDetails:
      type: object
      required:
        - recIndex
        - physicalAddress
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        physicalAddress:
          $ref: '#/components/schemas/PhysicalAddress'
        productType:
          type: string
          description: |
            Tipo di invio cartaceo effettivamente inviato
              - __RS__: Raccomandata nazionale Semplice (per Avviso di mancato Recapito)
              - __RIS__: Raccomandata internazionale Semplice
        analogCost:
          type: integer
          description: costo in eurocent dell'invio
          format: int32
        numberOfPages:
          type: integer
          description: numero delle pagina che compongono la spedizione cartacea
          format: int32
        envelopeWeight:
          type: integer
          description: peso in grammi della busta
          format: int32
        prepareRequestId:
          type: string
          description: request id della relativa richiesta di prepare
    AarCreationRequestDetails:
      type: object
      required:
        - recIndex
        - aarKey
        - numberOfPages
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        aarKey:
          type: string
          description: Chiave per recupero da safe-storage del documento aar
        numberOfPages:
          type: integer
          description: numero di pagine del PDF generato
          format: int32
    AarGenerationDetails:
      type: object
      required:
        - recIndex
        - generatedAarUrl
        - numberOfPages
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        generatedAarUrl:
          type: string
          description: Chiave per recupero da safe-storage del documento aar
        numberOfPages:
          type: integer
          description: numero di pagine del PDF generato
          format: int32
    NotHandledDetails:
      type: object
      required:
        - recIndex
        - reasonCode
        - reason
      properties:
        recIndex:
          type: integer
          description: Index destinatario notifica digitale
          format: int32
        reasonCode:
          type: string
          description: Codice motivazione casistica non gestita
        reason:
          type: string
          description: Motivazione casistica non gestita
    NotificationPaidDetails:
      type: object
      required:
        - recIndex
        - recipientType
        - paymentSourceChannel
      properties:
        recIndex:
          type: integer
          description: Index destinatario che ha effettuato il pagamento della notifica
          format: int32
        recipientType:
          $ref: '#/components/schemas/RecipientType'
        amount:
          type: integer
          description: Importo di pagamento in eurocent
          format: int32
        creditorTaxId:
          $ref: '#/components/schemas/paTaxId'
        noticeCode:
          $ref: '#/components/schemas/noticeCode'
        idF24:
          type: string
          description: un UUID che identifica un pagamento f24
        paymentSourceChannel:
          type: string
          description: Canale sorgente della richiesta di pagamento
        uncertainPaymentDate:
          type: boolean
          description: Indica se la data di pagamento é certa
    SendAnalogProgressDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario che ha effettuato il pagamento della notifica
          format: int32
        notificationDate:
          type: string
          format: date-time
        deliveryFailureCause:
          type: string
          description: Vedi deliveryFailureCause in SendAnalogFeedbackDetails
        deliveryDetailCode:
          type: string
          description: Vedi deliveryDetailCode in SendAnalogFeedbackDetails
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/AttachmentDetails'
        sendRequestId:
          type: string
          description: RequestId della richiesta d'invio
        registeredLetterCode:
          type: string
          description: Codice della raccomandata
    SimpleRegisteredLetterProgressDetails:
      type: object
      required:
        - recIndex
      properties:
        recIndex:
          type: integer
          description: Index destinatario che ha effettuato il pagamento della notifica
          format: int32
        notificationDate:
          type: string
          format: date-time
        deliveryFailureCause:
          type: string
          description: Vedi deliveryFailureCause in SendAnalogFeedbackDetails
        deliveryDetailCode:
          type: string
          description: Vedi deliveryDetailCode in SendAnalogFeedbackDetails
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/AttachmentDetails'
        sendRequestId:
          type: string
          description: RequestId della richiesta d'invio
        registeredLetterCode:
          type: string
          description: Codice della raccomandata
    ProbableDateAnalogWorkflowDetails:
      type: object
      required:
        - recIndex
        - schedulingAnalogDate
      properties:
        recIndex:
          type: integer
          description: Index destinatario che ha effettuato il pagamento della notifica
          format: int32
        schedulingAnalogDate:
          type: string
          format: date-time
          description: Data probabile di inizio del flusso analogico
    TimelineElementDetails:
      description: The raw event payload that will be different based on the event.
      oneOf:
        - $ref: '#/components/schemas/SenderAckCreationRequestDetails'
        - $ref: '#/components/schemas/NormalizedAddressDetails'
        - $ref: '#/components/schemas/NotificationRequestAcceptedDetails'
        - $ref: '#/components/schemas/AnalogFailureWorkflowDetails'
        - $ref: '#/components/schemas/AnalogSuccessWorkflowDetails'
        - $ref: '#/components/schemas/CompletelyUnreachableCreationRequestDetails'
        - $ref: '#/components/schemas/CompletelyUnreachableDetails'
        - $ref: '#/components/schemas/DigitalDeliveryCreationRequestDetails'
        - $ref: '#/components/schemas/DigitalFailureWorkflowDetails'
        - $ref: '#/components/schemas/DigitalSuccessWorkflowDetails'
        - $ref: '#/components/schemas/GetAddressInfoDetails'
        - $ref: '#/components/schemas/NotificationViewedCreationRequestDetails'
        - $ref: '#/components/schemas/NotificationViewedDetails'
        - $ref: '#/components/schemas/PublicRegistryCallDetails'
        - $ref: '#/components/schemas/PublicRegistryResponseDetails'
        - $ref: '#/components/schemas/RefinementDetails'
        - $ref: '#/components/schemas/RequestRefusedDetails'
        - $ref: '#/components/schemas/ScheduleAnalogWorkflowDetails'
        - $ref: '#/components/schemas/ScheduleDigitalWorkflowDetails'
        - $ref: '#/components/schemas/ScheduleRefinementDetails'
        - $ref: '#/components/schemas/SendCourtesyMessageDetails'
        - $ref: '#/components/schemas/PrepareDigitalDetails'
        - $ref: '#/components/schemas/SendDigitalDetails'
        - $ref: '#/components/schemas/SendDigitalFeedbackDetails'
        - $ref: '#/components/schemas/SendDigitalProgressDetails'
        - $ref: '#/components/schemas/BaseAnalogDetails'
        - $ref: '#/components/schemas/SendAnalogDetails'
        - $ref: '#/components/schemas/SendAnalogFeedbackDetails'
        - $ref: '#/components/schemas/BaseRegisteredLetterDetails'
        - $ref: '#/components/schemas/SimpleRegisteredLetterDetails'
        - $ref: '#/components/schemas/AarCreationRequestDetails'
        - $ref: '#/components/schemas/AarGenerationDetails'
        - $ref: '#/components/schemas/NotHandledDetails'
        - $ref: '#/components/schemas/NotificationPaidDetails'
        - $ref: '#/components/schemas/SendAnalogProgressDetails'
        - $ref: '#/components/schemas/SimpleRegisteredLetterProgressDetails'
        - $ref: '#/components/schemas/ProbableDateAnalogWorkflowDetails'
    NotificationAttachmentDownloadMetadataResponse:
      title: Url e metadati per il download di un allegato di una notifica
      description: |-
        I due campi più importanti sono __url__ e __retryAfter__. <br/>
          - __url__ è presente se il file è pronto per essere scaricato ed indica l'url a cui fare GET.
          - __retryAfter__ indica che il file è stato archiviato e bisognerà aspettare un numero di
            secondi non inferiore a quanto indicato dal campo _retryAfter_. <br/>
      type: object
      required:
        - filename
        - contentType
        - contentLength
        - sha256
      properties:
        filename:
          type: string
        contentType:
          type: string
          example: application/pdf
        contentLength:
          type: integer
          format: int32
          example: 54092
          description: dimensione, in byte, del contenuto.
        sha256:
          type: string
          description: SHA256 del contenuto del file.
        url:
          type: string
          description: URL preautorizzato a cui effettuare una richiesta GET per ottenere il  contenuto del documento. Presente solo se il documento è pronto per il download.
        retryAfter:
          type: integer
          format: int32
          description: Stima del numero di secondi da aspettare prima che il contenuto del  documento sia disponibile per il download.
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
